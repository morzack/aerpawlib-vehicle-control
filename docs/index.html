<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>aerpawlib API documentation</title>
<meta name="description" content="`aerpawlib` is a set of frameworks and tools that abstract away lower level
concepts needed to write complex scripts that run on the AERPAW platform â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>aerpawlib</code></h1>
</header>
<section id="section-intro">
<p><code><a title="aerpawlib" href="#aerpawlib">aerpawlib</a></code> is a set of frameworks and tools that abstract away lower level
concepts needed to write complex scripts that run on the AERPAW platform. This
lib is intended to be used by both internal developers and researchers.</p>
<p>aerpawlib has two main design goals:</p>
<ul>
<li>Users of this lib must be able to directly translate mission logic into code
without worrying about higher level programming concepts.</li>
<li>The library must remain as Pythonic as possible, both internally and with how
it exposes itself.</li>
</ul>
<h2 id="getting-started-with-aerpawlib">Getting Started with aerpawlib</h2>
<p>This guide will take you through all the steps needed to get a basic
aerpawlib driven program working from scratch. It will also explain some of
the design decisions made by aerpawlib in some depth.</p>
<h3 id="installing-aerpawlib">Installing aerpawlib</h3>
<p>Before installing aerpawlib, there are a few dependencies that you need to
grab:</p>
<ul>
<li><code>python</code> &ndash; versions between <code>3.6</code> and <code>3.9</code> are supported</li>
<li><code>pip</code> &ndash; should be bundled with python in most distributions</li>
</ul>
<p>To install aerpawlib:</p>
<ul>
<li>Clone this repo. Avoid changing the path if possible after installation.</li>
<li><code>cd AERPAW-Dev/AHN/E-VM/Profile_software/vehicle_control/aerpawlib</code></li>
<li>Install as a local lib &ndash; <code>pip install --user -e .</code></li>
</ul>
<p>After following these steps, aerpawlib will now be usable in any python
script, provided that the path isn't changed.</p>
<p>To update aerpawlib, you can simply <code>git pull</code> inside the dir to sync with
the upstream repo.</p>
<h3 id="creating-a-basic-runner">Creating a basic runner</h3>
<p>aerpawlib is built so that any script made with it in mind can be run in the
same way. To do this, it sacrifices a bit of functionality and enforces that
scripts implement a <code><a title="aerpawlib.runner.Runner" href="runner.html#aerpawlib.runner.Runner">Runner</a></code>.</p>
<p>There are two main runners used by aerpawlib &ndash; the
<code><a title="aerpawlib.runner.BasicRunner" href="runner.html#aerpawlib.runner.BasicRunner">BasicRunner</a></code>, and the <code><a title="aerpawlib.runner.StateMachine" href="runner.html#aerpawlib.runner.StateMachine">StateMachine</a></code>:</p>
<ul>
<li><code><a title="aerpawlib.runner.BasicRunner" href="runner.html#aerpawlib.runner.BasicRunner">BasicRunner</a></code> &ndash; has a single entry point, all flow
control is handled by the user program</li>
<li><code><a title="aerpawlib.runner.StateMachine" href="runner.html#aerpawlib.runner.StateMachine">StateMachine</a></code> &ndash; has multiple states of various types,
flow between states is handled by aerpawlib</li>
</ul>
<p><code><a title="aerpawlib.runner.BasicRunner" href="runner.html#aerpawlib.runner.BasicRunner">BasicRunner</a></code> is appropriate for the most basic of scripts,
so we'll use that here. It can be imported directly and linked to your script's
<code><a title="aerpawlib.runner.Runner" href="runner.html#aerpawlib.runner.Runner">Runner</a></code> instance by doing the following:</p>
<pre><code class="language-python">from aerpawlib.runner import BasicRunner
from aerpawlib.vehicle import Drone

class MyScript(BasicRunner):
    # more things...
</code></pre>
<p>When using a <code><a title="aerpawlib.runner.BasicRunner" href="runner.html#aerpawlib.runner.BasicRunner">BasicRunner</a></code>, you're allowed to create a single
function that serves as an entry point for your code. This function &ndash; decorated
by <code><a title="aerpawlib.runner.entrypoint" href="runner.html#aerpawlib.runner.entrypoint">entrypoint()</a></code> &ndash; will be called and passed a <code>Vehicle</code> at
runtime that you can interact with.</p>
<pre><code class="language-python">    # more things...
    @entrypoint
    async def my_function(self, vehicle: Drone):
        print(&quot;I'm doing things!&quot;)
</code></pre>
<p>[note: don't worry about the <code>async</code> yet! that'll be talked about a bit later]</p>
<p>Now you can run your script using the aerpawlib CLI tool:</p>
<pre><code class="language-bash">python -m aerpawlib \
    --script path/to/your/script \  # without the .py!
    --conn udp:127.0.0.1:14550 \    # or whatever SITL is using
    --vehicle drone
</code></pre>
<pre><code class="language-txt"># output after connecting:
I'm doing things!
</code></pre>
<p>The above command assumes you have SITL installed and it's up and running. To
install SITL, check out <a href="">TODO</a>.</p>
<h3 id="interacting-with-vehicles">Interacting with vehicles</h3>
<p>As mentioned before, the function marked by <code><a title="aerpawlib.runner.entrypoint" href="runner.html#aerpawlib.runner.entrypoint">entrypoint()</a></code> in
your script will always be passed a <code><a title="aerpawlib.vehicle.Vehicle" href="vehicle.html#aerpawlib.vehicle.Vehicle">Vehicle</a></code> of some kind
&ndash; this vehicle is determined by the vehicle <em>type</em> passed to the command line
tool.</p>
<p>There are a few kinds of vehicles that you can work with, each under
<code><a title="aerpawlib.vehicle" href="vehicle.html">aerpawlib.vehicle</a></code>. For this script, we'll be using a <code>Drone</code> since it has
more capabilities.</p>
<p>The aerpawlib CLI tool will fully initialize whatever vehicle you're using to
be ready to use, however you must explicitly make it take off at the start of
your script.</p>
<pre><code class="language-python">async def my_function(self, vehicle: Drone):
    # ...
    await vehicle.takeoff(5) # take off to 5 meters
</code></pre>
<p>Once the drone is in the air, you have full control over its position and
heading by using <code><a title="aerpawlib.vehicle.Vehicle.goto_coordinates" href="vehicle.html#aerpawlib.vehicle.Vehicle.goto_coordinates">Vehicle.goto_coordinates()</a></code> and
<code><a title="aerpawlib.vehicle.Drone.set_heading" href="vehicle.html#aerpawlib.vehicle.Drone.set_heading">Drone.set_heading()</a></code>.</p>
<p>Additionally, <code><a title="aerpawlib.vehicle.Vehicle" href="vehicle.html#aerpawlib.vehicle.Vehicle">Vehicle</a></code>s expose properties related to their
current physical state, such as their battery level and current position.</p>
<h3 id="using-coordinates">Using coordinates</h3>
<p>aerpawlib is designed to <em>only</em> have an understanding of absolute coordinates
using latitude and longitude &ndash; this removes an entire class of bugs and
confusion related to whether or not a vehicle is moving relative to its start
position or world-scale coordinates. Imagine if you tried to send a vehicle to
<code>(0, 0)</code>, but instead of coming home, it tried to fly out into the middle of
the ocean!</p>
<p>Keeping this in mind, aerpawlib wraps all positions inside the
<code><a title="aerpawlib.util.Coordinate" href="util.html#aerpawlib.util.Coordinate">Coordinate</a></code> object. This is a representation of an absolute
coordinate, with the altitude being relative to where the vehicle started.</p>
<p>To transform <code><a title="aerpawlib.util.Coordinate" href="util.html#aerpawlib.util.Coordinate">Coordinate</a></code>s, there's also a related
<code><a title="aerpawlib.util.VectorNED" href="util.html#aerpawlib.util.VectorNED">VectorNED</a></code> class &ndash; this is a 3 dimensional vector in the
<a href="https://en.wikipedia.org/wiki/Local_tangent_plane_coordinates#Local_north,_east,_down_(NED)_coordinates">NED (north, east, down)</a>
schema. aerpawlib has overridden some of Python's operators so that you can
cleanly combine coordinates with vectors.</p>
<pre><code class="language-python">from aerpawlib.util import Coordinate, VectorNED

x = Coordinate(35.771634, -78.674109)

# get a new coord 10m north and 5m west of X
y = x + VectorNED(10, -5, 0)

# find the bearing (heading difference) between X and Y
x.bearing(y)    # -&gt; 315 degrees

# get the vector between Y and X
vec = y - x     # -&gt; VectorNED(-10, 5, 0)
</code></pre>
<h3 id="moving-a-vehicle">Moving a vehicle</h3>
<p>So by using a vehicle's current position combined with a vector representing
how you want to translate it, you have nearly full control over a vehicle's
position.</p>
<p>As an example, let's move a drone in a square pattern:</p>
<pre><code>async def my_function(self, vehicle: Drone):
    # ...
    # go north
    await vehicle.goto_coordinates(vehicle.position + VectorNED(10, 0, 0))
    await asyncio.sleep(5) # seconds

    # go west
    await vehicle.goto_coordinates(vehicle.position + VectorNED(0, -10, 0))
    await asyncio.sleep(5)

    # go south
    await vehicle.goto_coordinates(vehicle.position + VectorNED(-10, 0, 0))
    await asyncio.sleep(5)

    # go east
    await vehicle.goto_coordinates(vehicle.position + VectorNED(0, 10, 0))
    await asyncio.sleep(5)

    # don't forget to land when you're done!
    await vehicle.land()
</code></pre>
<h3 id="asynchronous-programming">Asynchronous programming</h3>
<p>Because the physical state of a drone and the state of a program aren't
inherently linked, aerpawlib uses asyncio internally to help with syncing
things up.</p>
<p>What this means for you, the developer of a script, is that there are two
actions that your script can take after telling a drone what to do &ndash; it can
either wait for the drone to complete the action before resuming the flow, or
it can continue running while waiting for the drone to finish moving in the
background.</p>
<p>In Python, these two actions are specified using the <code>await</code> keyword, or the
function <code>asyncio.ensure_future</code>:</p>
<pre><code class="language-python">async def my_function(self, vehicle: Drone):
    # go north and (a)wait for the drone to arrive
    await vehicle.goto_coordinates(vehicle.position + VectorNED(10, 0, 0))

    # go south and immediately print some things out
    action = asyncio.ensure_future(vehicle.goto_coordinates(vehicle.position
                                                            + VectorNED(0, 10, 0)))
    print(&quot;going south now...&quot;)

    # wait for the action to be finished
    await action
</code></pre>
<p>In the second example above, we capture the <code>asyncio.Task</code> returned by
<code>asyncio.ensure_future</code>, which allows for us to then <code>await</code> it later on. It's
not necessary to do this unless you want to use <code>await</code> later.</p>
<p><strong>Important!</strong></p>
<p>One caveat of using asyncio is that you can't use any functions that would
normally block the execution of the program. Fortunately, asyncio provides
implementations of the common culprits, such as <code>time.sleep</code> &ndash; you can see how
they're used in some of the above examples.</p>
<h3 id="background-tasks">Background tasks</h3>
<p>One of the benefits of asyncio is that it allows for aerpawlib to cleanly
implement tasks that run in the background. aerpawlib exposes this
functionality through the <code><a title="aerpawlib.runner.background" href="runner.html#aerpawlib.runner.background">background()</a></code> decorator, which
causes the decorated function to be repeatedly called in the background:</p>
<pre><code class="language-python">class MyRunner(StateMachine):
    @background
    async def log_in_background(self, vehicle: Vehicle):
        print(f&quot;vehicle pos: {vehicle.position}&quot;)
        await asyncio.sleep(1)
</code></pre>
<p>Note that background tasks are only available to runners that use the
<code><a title="aerpawlib.runner.StateMachine" href="runner.html#aerpawlib.runner.StateMachine">StateMachine</a></code> framework.</p>
<h3 id="creating-a-state-machine">Creating a state machine</h3>
<p>The more powerful of aerpawlib's two frameworks is
<code><a title="aerpawlib.runner.StateMachine" href="runner.html#aerpawlib.runner.StateMachine">StateMachine</a></code>: this framework lets you create a runner with
multiple "states" that can be transitioned between by the runner.</p>
<p>A state is just a function decorated by the <code><a title="aerpawlib.runner.state" href="runner.html#aerpawlib.runner.state">state()</a></code> decorator.
This decorator allows for a state to be given a name &ndash; this name is what
aerpawlib uses to identify states when transitioning between them.</p>
<p>When the state function is done running, it should return a string that is the
next state for the runner to run. If no string is returned, aerpawlib assumes
that the script is done running.</p>
<p>The first state used in a script must be designated by setting the
<code>first</code> parameter to true when creating it.</p>
<p>Finally, there's also a <code><a title="aerpawlib.runner.timed_state" href="runner.html#aerpawlib.runner.timed_state">timed_state()</a></code> decorator available.
This decorator will make sure that a state is run for <em>at least</em> a set number
of seconds before transitioning to the next state, even if the state exits
early. If the function designated as a state takes longer than the allotted
time, it will continue running until a value is returned or the function
exits.</p>
<p>Here's an example of a state machine that makes use of all the things we've
talked about so far. It makes a drone continually "take measurements" spaced
10m apart until it gets a measurement that is 0, at which point it lands.</p>
<pre><code class="language-python">class MyScript(StateMachine):
    @state(name=&quot;start&quot;, first=True)
    async def start(self, vehicle: Vehicle):
        await vehicle.take_off(5)
        return &quot;go_north&quot;

    @state(name=&quot;go_north&quot;)
    async def go_north(self, vehicle: Vehicle):
        # go north and continually log the vehicle's position
        moving = asyncio.ensure_future(vehicle.goto_coordinates(vehicle.position + VectorNED(10, 0, 0)))

        while not moving.done():
            print(f&quot;pos: {vehicle.position}&quot;)
            await asyncio.sleep(0.1)

        await moving
        return &quot;take_measurement&quot;

    @timed_state(name=&quot;take_measurement&quot;, duration=5)
    async def take_measurement(self, vehicle: Vehicle):
        # take a measurement and wait for 5 seconds
        measurement = random.randint(0, 5)

        if measurement == 0:
            return &quot;land&quot;
        else:
            return &quot;go_north&quot;

    @state(name=&quot;land&quot;)
    asnyc def land(self, vehicle: Vehicle):
        await vehicle.land()
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
.. include:: ./documentation.md
&#34;&#34;&#34;

__version__ = &#34;0.0.1&#34;
__author__ = &#34;John Kesler&#34;

from .runner import *
from .vehicle import *
from .util import *
from .external import *</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="aerpawlib.external" href="external.html">aerpawlib.external</a></code></dt>
<dd>
<div class="desc"><p>Utilities allowing for aerpawlib scripts to interact with external processes
running in a userspace.</p></div>
</dd>
<dt><code class="name"><a title="aerpawlib.runner" href="runner.html">aerpawlib.runner</a></code></dt>
<dd>
<div class="desc"><p>Collection of execution frameworks that can be extended to make scripts
runnable using aerpawlib. The most basic framework is <code>Runner</code> &ndash; any custom
â€¦</p></div>
</dd>
<dt><code class="name"><a title="aerpawlib.test" href="test/index.html">aerpawlib.test</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="aerpawlib.util" href="util.html">aerpawlib.util</a></code></dt>
<dd>
<div class="desc"><p>Types and functions commonly used throughout the aerpawlib framework.</p></div>
</dd>
<dt><code class="name"><a title="aerpawlib.vehicle" href="vehicle.html">aerpawlib.vehicle</a></code></dt>
<dd>
<div class="desc"><p>Core logic surrounding the various <code>Vehicle</code>s available to aerpawlib user
scripts</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#getting-started-with-aerpawlib">Getting Started with aerpawlib</a><ul>
<li><a href="#installing-aerpawlib">Installing aerpawlib</a></li>
<li><a href="#creating-a-basic-runner">Creating a basic runner</a></li>
<li><a href="#interacting-with-vehicles">Interacting with vehicles</a></li>
<li><a href="#using-coordinates">Using coordinates</a></li>
<li><a href="#moving-a-vehicle">Moving a vehicle</a></li>
<li><a href="#asynchronous-programming">Asynchronous programming</a></li>
<li><a href="#background-tasks">Background tasks</a></li>
<li><a href="#creating-a-state-machine">Creating a state machine</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="aerpawlib.external" href="external.html">aerpawlib.external</a></code></li>
<li><code><a title="aerpawlib.runner" href="runner.html">aerpawlib.runner</a></code></li>
<li><code><a title="aerpawlib.test" href="test/index.html">aerpawlib.test</a></code></li>
<li><code><a title="aerpawlib.util" href="util.html">aerpawlib.util</a></code></li>
<li><code><a title="aerpawlib.vehicle" href="vehicle.html">aerpawlib.vehicle</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>