<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.3"/>
    <title>aerpawlib.vehicle API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../aerpawlib.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;aerpawlib</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DummyVehicle">DummyVehicle</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DummyVehicle.__init__">DummyVehicle</a>
                        </li>
                        <li>
                                <a class="function" href="#DummyVehicle.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Vehicle">Vehicle</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Vehicle.__init__">Vehicle</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.connected">connected</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.position">position</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.battery">battery</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.gps">gps</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.armed">armed</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.home_coords">home_coords</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.heading">heading</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.velocity">velocity</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.autopilot_info">autopilot_info</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vehicle.attitude">attitude</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.debug_dump">debug_dump</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.done_moving">done_moving</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.await_ready_to_move">await_ready_to_move</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.set_armed">set_armed</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.goto_coordinates">goto_coordinates</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.set_velocity">set_velocity</a>
                        </li>
                        <li>
                                <a class="function" href="#Vehicle.set_groundspeed">set_groundspeed</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Drone">Drone</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Drone.set_heading">set_heading</a>
                        </li>
                        <li>
                                <a class="function" href="#Drone.takeoff">takeoff</a>
                        </li>
                        <li>
                                <a class="function" href="#Drone.land">land</a>
                        </li>
                        <li>
                                <a class="function" href="#Drone.goto_coordinates">goto_coordinates</a>
                        </li>
                        <li>
                                <a class="function" href="#Drone.set_velocity">set_velocity</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Rover">Rover</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Rover.goto_coordinates">goto_coordinates</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../aerpawlib.html">aerpawlib</a><wbr>.vehicle    </h1>

                        <div class="docstring"><p>Core logic surrounding the various <code><a href="#Vehicle">Vehicle</a></code>s available to aerpawlib user
scripts</p>
</div>

                        <input id="mod-vehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-vehicle-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Core logic surrounding the various `Vehicle`s available to aerpawlib user</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">scripts</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">dronekit</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pymavlink</span><span class="w"> </span><span class="kn">import</span> <span class="n">mavutil</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">util</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.aerpaw</span><span class="w"> </span><span class="kn">import</span> <span class="n">AERPAW_Platform</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># time to wait when polling for dronekit vehicle state changes</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">_POLLING_DELAY</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># s</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1"># time to wait between steps of the arming -&gt; guided -&gt; takeoff sequence</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="n">_ARMING_SEQUENCE_DELAY</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># s</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="c1"># time between calls for itnernal update handling</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="n">_INTERNAL_UPDATE_DELAY</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># s</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="n">_YAW_BITMASK</span> <span class="o">=</span> <span class="mb">0b100111111111</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DummyVehicle</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    vehicle class for things that don&#39;t need vehicles</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="k">pass</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="k">pass</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_prearm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_postarm_init</span><span class="p">):</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="k">pass</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_postarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="k">pass</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Vehicle</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    Overarching &quot;generic vehicle&quot; type. Implements all functionality, excluding</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    movement commands (which are *always* vehicle specific).</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="n">_vehicle</span><span class="p">:</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Vehicle</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="n">_has_heartbeat</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="c1"># function used by &quot;verb&quot; functions to check and see if the vehicle can be</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="c1"># commanded to move. should be set to a new closure by verb functions to</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="c1"># redefine functionality</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="c1"># ready_to_move should be treated as a mutex of sorts -- when a vehicle function</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="c1"># is done waiting for it to clear, it should immediately set the function and make</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="c1"># it return false to avoid race conditions</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="n">_ready_to_move</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">object</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1"># temp hack to allow for dynamically making the drone abortable or not</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="c1"># aborting is triggered by mode changes, so we need to ignore the initial</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="c1"># takeoff and final landing changes</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="n">_abortable</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">_aborted</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">_home_location</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="c1"># _current_heading is used to blend heading and velocity control commands</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="c1"># if a script sets the vehicle&#39;s heading, it will override _current_heading and be used</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="c1"># for all future commands that can provide a heading</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">_current_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="n">_last_nav_controller_output</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="n">_last_mission_item_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="c1"># _verbose_logging is used to indicate if this vehicle should automatically dump</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="c1"># its information at a regular rate to a log file (all defined below)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="c1"># it can be set by a user script *or* by the aerpawlib runner</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="n">_verbose_logging</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">_verbose_logging_file_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;aerpawlib_vehicle_dump&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="n">_verbose_logging_file_writer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">_verbose_logging_last_log_time</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">_verbose_logging_delay</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span> <span class="c1"># s</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="n">wait_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">wait_ready</span><span class="p">()</span> <span class="c1"># we need to do this to capture</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                                            <span class="c1"># things such as the home location</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="c1"># # this hack is needed to wait for the autopilot to reply with all needed info for the runner</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1"># while self.autopilot_info.major == None: time.sleep(0.5)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="c1"># time at which the vehicle received the first guided command (takeoff/goto)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="c1"># register required listeners after connecting</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_heartbeat_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;last_heartbeat&quot;</span><span class="p">,</span> <span class="n">_heartbeat_listener</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_abort_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="c1"># TODO abort logic is more complicated :P</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="c1"># if value != &quot;GUIDED&quot;:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="c1">#     self._abort()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="k">return</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">_abort_listener</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_nav_controller_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;NAV_CONTROLLER_OUTPUT&quot;</span><span class="p">,</span> <span class="n">_nav_controller_listener</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_mission_item_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;MISSION_ITEM_INT&quot;</span><span class="p">,</span> <span class="n">_mission_item_listener</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="c1"># start separate thread for internal update support (not ideal, but can&#39;t think of an asyncio way)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_update_loop</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="c1"># wait for connection</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="c1"># nouns</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="nd">@property</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        True if receiving heartbeats, False otherwise</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="nd">@property</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        Get the current position of the Vehicle as a `util.Coordinate`</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_relative_frame</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="nd">@property</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">battery</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Battery</span><span class="p">:</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Get the status of the battery. Wraps `dronekit.Battery`, which makes</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        the `voltage`, `current`, and `level` available</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">battery</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="nd">@property</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">GPSInfo</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        Get the current GPS status (for gps_0 -- can be changed in the future).</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        Wraps `dronekit.GPSInfo`, which exposes the `fix_type` (0-1: no fix,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        2: 2d fix, 3: 3d fix), and number of `satellites_visible`, among other</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        things.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">gps_0</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="nd">@property</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">armed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="nd">@property</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">home_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_home_location</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="nd">@property</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">heading</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="nd">@property</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="nd">@property</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">autopilot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">version</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="nd">@property</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">attitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Attitude</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        attitude of the vehicle, all values in radians</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        - pitch/roll are horizon-relative</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        - yaw is world relative (north=0)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">attitude</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Dump various properties collected by this vehicle and the underlying dronekit</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        vehicle type to a string for logging/debug purposes.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        Serialization is handled by this function, call it to get an idea of the output</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        format.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="c1"># TODO provide a deserialization function in util.py for this output</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_roll</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_pitch</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_bearing</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">target_bearing</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">wp_dist</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">alt_error</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">aspd_error</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">xtrack_error</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">(),</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">attitude</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">autopilot_info</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">battery</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gps</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">home_coords</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">nav_controller_ouptut</span><span class="p">,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="n">mission_item_output</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="p">]</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">props</span><span class="p">))</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="c1"># internal logic</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_update_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_update</span><span class="p">()</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_INTERNAL_UPDATE_DELAY</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="c1"># called regularly at some given frequency by an internal update loop (separate thread)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_last_log_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_delay</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">log_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_dump</span><span class="p">()</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">log_output</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_last_log_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>    
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    <span class="c1"># special things</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">done_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        See if the vehicle is ready to move (i.e. if the last movement command</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        has been completed). Also makes sure that the vehicle is connected and</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        that we haven&#39;t aborted.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        </span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        This is more accurately a function that describes the vehicle&#39;s</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        willingness to take a new command.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="c1"># syntax hack. functions and methods are different and need to be called</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="c1"># differently to prevent them from being bound to self</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">,</span> <span class="s2">&quot;__func__&quot;</span><span class="p">):</span>        <span class="c1"># method</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="o">.</span><span class="vm">__func__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                    <span class="c1"># function</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">await_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        Helper function that blocks execution and waits for the vehicle to</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        finish the current action/movement that it was instructed to do.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        Makes use of `Vehicle.done_moving`</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        Additionally, will block and request arming if the vehicle isn&#39;t yet</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        armed.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_postarm</span><span class="p">()</span> <span class="c1"># also contains logic to wait for arm</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done_moving</span><span class="p">():</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="c1"># TODO this should be something different in the future.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="c1"># the intent of it in the past has been blocking further execution of</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="c1"># more vehicle control logic.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="n">AERPAW_Platform</span><span class="o">.</span><span class="n">log_to_oeo</span><span class="p">(</span><span class="s2">&quot;[aerpawlib] Aborted.&quot;</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="c1"># verbs</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Clean up the `Vehicle` object/any state</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_armed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        Arm or disarm this vehicle, and wait for it to be armed (if possible)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        Dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        all!), so this will block execution until the vehicle has been armed.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        If the vehicle can&#39;t be armed, an Exception is raised.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="c1"># dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at all!)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="c1"># this pattern keeps the funky logic out of the experimenter&#39;s script</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="c1"># to make sure that things are safer overall</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not ready to arm&quot;</span><span class="p">)</span> <span class="c1"># in this case, the script dies completely</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                                                <span class="c1"># obviously not optimal *unless* we are</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                                                <span class="c1"># certain that a scipt always arms once</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_prearm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_postarm_init</span><span class="p">):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">system_status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;STANDBY&quot;</span><span class="p">,</span> <span class="s2">&quot;ACTIVE&quot;</span><span class="p">]:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span> <span class="o">=</span> <span class="n">should_postarm_init</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_postarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        Generic pre-mission manipulation of the vehicle into a state that is</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        acceptable. MUST be called before anything else. Though this is done by</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">        the runner.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="k">return</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="n">AERPAW_Platform</span><span class="o">.</span><span class="n">log_to_oeo</span><span class="p">(</span><span class="s2">&quot;[aerpawlib] Guided command attempted. Waiting for safety pilot to arm&quot;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_ARMING_SEQUENCE_DELAY</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;GUIDED&quot;</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_ARMING_SEQUENCE_DELAY</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_home_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        Make the vehicle go to provided coordinates.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        `tolerance` is the min distance away from the coordinates, in meters,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        that is acceptable.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        `target_heading`, when set, will make the drone point in the specified</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        direction (absolute). Otherwise the drone will remain pointing in the</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        current direction. This is only available on drones.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        This method is only available for vehicles built off the `Vehicle` type</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        (ex: `Drone` or `Rover`)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Generic vehicles can&#39;t go to coordinates!&quot;</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        Set a drone&#39;s velocity that it will use for `duration` seconds.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        The velocity vector provided will be inerpreted as being global</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        relative *in direction* unless the `global_relative` parameter is set</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        to False.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        The vehicle will maintain this velocity for `duration` seconds, if</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        `duration` is provided, otherwise it will automatically maintain the</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        specified velocity until another command is sent.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        The vehicle&#39;s velocity vector, if it has a magnitude greater than the</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        configured &quot;max_velocity&quot; (configurable in aerpawlib by using a config.yaml</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        file with the --vehicle-config argument, defaults to 5 m/s), will be</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        normalized and rescaled such that the new magnitude is equal to the</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        maximum velocity.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;set_velocity not implemented&quot;</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_groundspeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Set a vehicle&#39;s cruise velocity as used by the autopilot when performing</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        guided movement operations (ex: goto_coordinates). In m/s.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        NOTE:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">            This is not always respected by the autopilot and will not succeed</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">            on rover type vehicles in simulation.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">groundspeed</span> <span class="o">=</span> <span class="n">velocity</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        Internal utility to stop any movement being run in the background. This</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        ignores await_ready_to_move(). Requires set_velocity to be implemented</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        for the given vehicle.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        TODO needs testing. setting velocity to 0\bar may not be best way to</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        stop</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Drone</span><span class="p">(</span><span class="n">Vehicle</span><span class="p">):</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">    Drone vehicle type. Implements all functionality that AERPAW&#39;s drones</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">    expose to user scripts, which includes basic movement control (going to</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    coords, turning, landing).</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lock_in</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        Set the heading of the vehicle (in absolute deg).</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        </span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        To turn a relative # of degrees, you can do something like</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        `drone.set_heading(drone.heading + x)`</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">        Pass in `None` to make the drone return to ardupilot&#39;s default heading</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        behavior (usually facing the direction of movement)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">        If `blocking` is `True`, this will wait for the current movement command</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        to finish before setting the controller&#39;s yaw -- in this case, the drone</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        will immediately start turning. If `blocking` is `False`, the new yaw </span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        will only affect future commands that interact with the yaw controller</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        (ex: `set_velocity`)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        If `lock_in` is `True`, subsequent commands that could affect the heading</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        will respect the heading set by this command. If it is false, consider this</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        call to temporarily set the heading.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        An example of this in action is as follows: set_heading is called to lock in</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        a 90 degree heading, followed by a goto command. The goto command will look</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        at the 90 degrees heading set before. If lock_in were false, the goto</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        command would make the drone face the direction of travel.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="k">if</span> <span class="n">heading</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="k">return</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="n">heading</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="n">lock_in</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="n">heading</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="k">return</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">command_long_encode</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                                       <span class="c1"># target system, component</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_CONDITION_YAW</span><span class="p">,</span>      <span class="c1"># command</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># confirmation</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="n">heading</span><span class="p">,</span>                                    <span class="c1"># yaw angle in deg</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># yaw speed in deg/s</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># direction to turn in (-1: ccw, 1: cw)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># never turn relative to our current heading</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>                                     <span class="c1"># unused</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>            <span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>            <span class="n">_TURN_TOLERANCE_DEG</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="n">turn_diff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">heading</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">-</span> <span class="p">(</span><span class="n">heading</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)]])</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="k">return</span> <span class="n">turn_diff</span> <span class="o">&lt;=</span> <span class="n">_TURN_TOLERANCE_DEG</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">_pointed_at_heading</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">takeoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_alt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">min_alt_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wait_for_throttle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        Make the drone take off to a specific altitude, and blocks until the</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">        drone has reached that altitude.</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        Additionally waits to make sure that channel 4 of RCIN (used for yaw)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        is centered to avoid yaw during takeoff if the drone was *just* armed.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>        
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="k">if</span> <span class="n">wait_for_throttle</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="c1"># TODO the below logic needs to be tested at the field (and likely made less brittle)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="c1"># wait for sticks to return to center by taking rolling avg (30 frames)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="n">rcin_4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">999</span><span class="p">]</span> <span class="o">*</span> <span class="mi">30</span> <span class="c1"># use something obviously out of range</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_rcin_4_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chan4_raw</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="mi">1450</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1550</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">remove_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_takeoff</span><span class="p">(</span><span class="n">target_alt</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="n">taken_off</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">alt</span> <span class="o">&gt;=</span> <span class="n">target_alt</span> <span class="o">*</span> <span class="n">min_alt_tolerance</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">taken_off</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">taken_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">land</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        Land the drone at its current position and block while waiting for it</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        to be disarmed. No further movement is allowed after the drone has been</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        landed (for now, may be changed later).</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;LAND&quot;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="n">target_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">target_heading</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">heading</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">bearing</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lock_in</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">mission_item_send</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_NAV_WAYPOINT</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># unused</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># hold time</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># accept radius</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># pass radius</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="n">heading</span><span class="p">,</span> <span class="c1"># yaw</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">alt</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="c1"># TODO in the future we likely want to split alt into a different tolerance</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>    <span class="n">_velocity_loop_active</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># TODO race condition bleh</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">global_relative</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="n">velocity_vector</span> <span class="o">=</span> <span class="n">velocity_vector</span><span class="o">.</span><span class="n">rotate_by_angle</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="n">bitmask</span> <span class="o">=</span> <span class="mb">0b0000111111000111</span>     <span class="c1"># bitmask to only set speed</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>            <span class="n">bitmask</span> <span class="o">&amp;=</span> <span class="n">_YAW_BITMASK</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="n">yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">set_position_target_global_int_encode</span><span class="p">(</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused, target sys, component</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>                <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT_INT</span><span class="p">,</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>                <span class="n">bitmask</span><span class="p">,</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">north</span><span class="p">,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">east</span><span class="p">,</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">down</span><span class="p">,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># (unsupported) accel</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yaw</span><span class="p">),</span> <span class="mi">0</span>    <span class="c1"># yaw/rate</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>                <span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="n">target_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">duration</span> <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>        
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_velocity_helper</span><span class="p">():</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                <span class="k">if</span> <span class="n">target_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">target_end</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>        <span class="c1"># TODO tune for better perf</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">_velocity_helper</span><span class="p">())</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Rover</span><span class="p">(</span><span class="n">Vehicle</span><span class="p">):</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">    Rover vehicle type. Implements all functionality that AERPAW&#39;s rovers</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">    expose to user scripts, which includes basic movement control (going to</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">    coords).</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">    `target_heading` is ignored for rovers, as they can&#39;t strafe.</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span> <span class="c1"># treat as mutex</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_goto</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">location</span><span class="p">())</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">ground_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="c1"># TODO break this down further?:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="c1"># class LAM(Drone)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="c1"># class SAM(Drone)</span>
</span></pre></div>


            </section>
                <section id="DummyVehicle">
                            <input id="DummyVehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DummyVehicle</span>:

                <label class="view-source-button" for="DummyVehicle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummyVehicle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummyVehicle-29"><a href="#DummyVehicle-29"><span class="linenos">29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DummyVehicle</span><span class="p">:</span>
</span><span id="DummyVehicle-30"><a href="#DummyVehicle-30"><span class="linenos">30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DummyVehicle-31"><a href="#DummyVehicle-31"><span class="linenos">31</span></a><span class="sd">    vehicle class for things that don&#39;t need vehicles</span>
</span><span id="DummyVehicle-32"><a href="#DummyVehicle-32"><span class="linenos">32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DummyVehicle-33"><a href="#DummyVehicle-33"><span class="linenos">33</span></a>    
</span><span id="DummyVehicle-34"><a href="#DummyVehicle-34"><span class="linenos">34</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DummyVehicle-35"><a href="#DummyVehicle-35"><span class="linenos">35</span></a>        <span class="k">pass</span>
</span><span id="DummyVehicle-36"><a href="#DummyVehicle-36"><span class="linenos">36</span></a>
</span><span id="DummyVehicle-37"><a href="#DummyVehicle-37"><span class="linenos">37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DummyVehicle-38"><a href="#DummyVehicle-38"><span class="linenos">38</span></a>        <span class="k">pass</span>
</span><span id="DummyVehicle-39"><a href="#DummyVehicle-39"><span class="linenos">39</span></a>
</span><span id="DummyVehicle-40"><a href="#DummyVehicle-40"><span class="linenos">40</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_prearm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_postarm_init</span><span class="p">):</span>
</span><span id="DummyVehicle-41"><a href="#DummyVehicle-41"><span class="linenos">41</span></a>        <span class="k">pass</span>
</span><span id="DummyVehicle-42"><a href="#DummyVehicle-42"><span class="linenos">42</span></a>
</span><span id="DummyVehicle-43"><a href="#DummyVehicle-43"><span class="linenos">43</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_postarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DummyVehicle-44"><a href="#DummyVehicle-44"><span class="linenos">44</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>vehicle class for things that don't need vehicles</p>
</div>


                            <div id="DummyVehicle.__init__" class="classattr">
                                        <input id="DummyVehicle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DummyVehicle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="DummyVehicle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummyVehicle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummyVehicle.__init__-34"><a href="#DummyVehicle.__init__-34"><span class="linenos">34</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DummyVehicle.__init__-35"><a href="#DummyVehicle.__init__-35"><span class="linenos">35</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                            <div id="DummyVehicle.close" class="classattr">
                                        <input id="DummyVehicle.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DummyVehicle.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DummyVehicle.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DummyVehicle.close-37"><a href="#DummyVehicle.close-37"><span class="linenos">37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DummyVehicle.close-38"><a href="#DummyVehicle.close-38"><span class="linenos">38</span></a>        <span class="k">pass</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Vehicle">
                            <input id="Vehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Vehicle</span>:

                <label class="view-source-button" for="Vehicle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle-46"><a href="#Vehicle-46"><span class="linenos"> 46</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Vehicle</span><span class="p">:</span>
</span><span id="Vehicle-47"><a href="#Vehicle-47"><span class="linenos"> 47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-48"><a href="#Vehicle-48"><span class="linenos"> 48</span></a><span class="sd">    Overarching &quot;generic vehicle&quot; type. Implements all functionality, excluding</span>
</span><span id="Vehicle-49"><a href="#Vehicle-49"><span class="linenos"> 49</span></a><span class="sd">    movement commands (which are *always* vehicle specific).</span>
</span><span id="Vehicle-50"><a href="#Vehicle-50"><span class="linenos"> 50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Vehicle-51"><a href="#Vehicle-51"><span class="linenos"> 51</span></a>    <span class="n">_vehicle</span><span class="p">:</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Vehicle</span>
</span><span id="Vehicle-52"><a href="#Vehicle-52"><span class="linenos"> 52</span></a>    <span class="n">_has_heartbeat</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="Vehicle-53"><a href="#Vehicle-53"><span class="linenos"> 53</span></a>
</span><span id="Vehicle-54"><a href="#Vehicle-54"><span class="linenos"> 54</span></a>    <span class="c1"># function used by &quot;verb&quot; functions to check and see if the vehicle can be</span>
</span><span id="Vehicle-55"><a href="#Vehicle-55"><span class="linenos"> 55</span></a>    <span class="c1"># commanded to move. should be set to a new closure by verb functions to</span>
</span><span id="Vehicle-56"><a href="#Vehicle-56"><span class="linenos"> 56</span></a>    <span class="c1"># redefine functionality</span>
</span><span id="Vehicle-57"><a href="#Vehicle-57"><span class="linenos"> 57</span></a>    <span class="c1"># ready_to_move should be treated as a mutex of sorts -- when a vehicle function</span>
</span><span id="Vehicle-58"><a href="#Vehicle-58"><span class="linenos"> 58</span></a>    <span class="c1"># is done waiting for it to clear, it should immediately set the function and make</span>
</span><span id="Vehicle-59"><a href="#Vehicle-59"><span class="linenos"> 59</span></a>    <span class="c1"># it return false to avoid race conditions</span>
</span><span id="Vehicle-60"><a href="#Vehicle-60"><span class="linenos"> 60</span></a>    <span class="n">_ready_to_move</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">object</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="Vehicle-61"><a href="#Vehicle-61"><span class="linenos"> 61</span></a>
</span><span id="Vehicle-62"><a href="#Vehicle-62"><span class="linenos"> 62</span></a>    <span class="c1"># temp hack to allow for dynamically making the drone abortable or not</span>
</span><span id="Vehicle-63"><a href="#Vehicle-63"><span class="linenos"> 63</span></a>    <span class="c1"># aborting is triggered by mode changes, so we need to ignore the initial</span>
</span><span id="Vehicle-64"><a href="#Vehicle-64"><span class="linenos"> 64</span></a>    <span class="c1"># takeoff and final landing changes</span>
</span><span id="Vehicle-65"><a href="#Vehicle-65"><span class="linenos"> 65</span></a>    <span class="n">_abortable</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Vehicle-66"><a href="#Vehicle-66"><span class="linenos"> 66</span></a>    <span class="n">_aborted</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Vehicle-67"><a href="#Vehicle-67"><span class="linenos"> 67</span></a>
</span><span id="Vehicle-68"><a href="#Vehicle-68"><span class="linenos"> 68</span></a>    <span class="n">_home_location</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="o">=</span><span class="kc">None</span>
</span><span id="Vehicle-69"><a href="#Vehicle-69"><span class="linenos"> 69</span></a>
</span><span id="Vehicle-70"><a href="#Vehicle-70"><span class="linenos"> 70</span></a>    <span class="c1"># _current_heading is used to blend heading and velocity control commands</span>
</span><span id="Vehicle-71"><a href="#Vehicle-71"><span class="linenos"> 71</span></a>    <span class="c1"># if a script sets the vehicle&#39;s heading, it will override _current_heading and be used</span>
</span><span id="Vehicle-72"><a href="#Vehicle-72"><span class="linenos"> 72</span></a>    <span class="c1"># for all future commands that can provide a heading</span>
</span><span id="Vehicle-73"><a href="#Vehicle-73"><span class="linenos"> 73</span></a>    <span class="n">_current_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span>
</span><span id="Vehicle-74"><a href="#Vehicle-74"><span class="linenos"> 74</span></a>
</span><span id="Vehicle-75"><a href="#Vehicle-75"><span class="linenos"> 75</span></a>    <span class="n">_last_nav_controller_output</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vehicle-76"><a href="#Vehicle-76"><span class="linenos"> 76</span></a>    <span class="n">_last_mission_item_int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vehicle-77"><a href="#Vehicle-77"><span class="linenos"> 77</span></a>
</span><span id="Vehicle-78"><a href="#Vehicle-78"><span class="linenos"> 78</span></a>    <span class="c1"># _verbose_logging is used to indicate if this vehicle should automatically dump</span>
</span><span id="Vehicle-79"><a href="#Vehicle-79"><span class="linenos"> 79</span></a>    <span class="c1"># its information at a regular rate to a log file (all defined below)</span>
</span><span id="Vehicle-80"><a href="#Vehicle-80"><span class="linenos"> 80</span></a>    <span class="c1"># it can be set by a user script *or* by the aerpawlib runner</span>
</span><span id="Vehicle-81"><a href="#Vehicle-81"><span class="linenos"> 81</span></a>    <span class="n">_verbose_logging</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Vehicle-82"><a href="#Vehicle-82"><span class="linenos"> 82</span></a>    <span class="n">_verbose_logging_file_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;aerpawlib_vehicle_dump&quot;</span>
</span><span id="Vehicle-83"><a href="#Vehicle-83"><span class="linenos"> 83</span></a>    <span class="n">_verbose_logging_file_writer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vehicle-84"><a href="#Vehicle-84"><span class="linenos"> 84</span></a>    <span class="n">_verbose_logging_last_log_time</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Vehicle-85"><a href="#Vehicle-85"><span class="linenos"> 85</span></a>    <span class="n">_verbose_logging_delay</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span> <span class="c1"># s</span>
</span><span id="Vehicle-86"><a href="#Vehicle-86"><span class="linenos"> 86</span></a>
</span><span id="Vehicle-87"><a href="#Vehicle-87"><span class="linenos"> 87</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vehicle-88"><a href="#Vehicle-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="n">wait_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vehicle-89"><a href="#Vehicle-89"><span class="linenos"> 89</span></a>        
</span><span id="Vehicle-90"><a href="#Vehicle-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</span><span id="Vehicle-91"><a href="#Vehicle-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">wait_ready</span><span class="p">()</span> <span class="c1"># we need to do this to capture</span>
</span><span id="Vehicle-92"><a href="#Vehicle-92"><span class="linenos"> 92</span></a>                                            <span class="c1"># things such as the home location</span>
</span><span id="Vehicle-93"><a href="#Vehicle-93"><span class="linenos"> 93</span></a>        
</span><span id="Vehicle-94"><a href="#Vehicle-94"><span class="linenos"> 94</span></a>        <span class="c1"># # this hack is needed to wait for the autopilot to reply with all needed info for the runner</span>
</span><span id="Vehicle-95"><a href="#Vehicle-95"><span class="linenos"> 95</span></a>        <span class="c1"># while self.autopilot_info.major == None: time.sleep(0.5)</span>
</span><span id="Vehicle-96"><a href="#Vehicle-96"><span class="linenos"> 96</span></a>        
</span><span id="Vehicle-97"><a href="#Vehicle-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vehicle-98"><a href="#Vehicle-98"><span class="linenos"> 98</span></a>
</span><span id="Vehicle-99"><a href="#Vehicle-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle-100"><a href="#Vehicle-100"><span class="linenos">100</span></a>
</span><span id="Vehicle-101"><a href="#Vehicle-101"><span class="linenos">101</span></a>        <span class="c1"># time at which the vehicle received the first guided command (takeoff/goto)</span>
</span><span id="Vehicle-102"><a href="#Vehicle-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vehicle-103"><a href="#Vehicle-103"><span class="linenos">103</span></a>
</span><span id="Vehicle-104"><a href="#Vehicle-104"><span class="linenos">104</span></a>        <span class="c1"># register required listeners after connecting</span>
</span><span id="Vehicle-105"><a href="#Vehicle-105"><span class="linenos">105</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_heartbeat_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle-106"><a href="#Vehicle-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle-107"><a href="#Vehicle-107"><span class="linenos">107</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vehicle-108"><a href="#Vehicle-108"><span class="linenos">108</span></a>            <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle-109"><a href="#Vehicle-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle-110"><a href="#Vehicle-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;last_heartbeat&quot;</span><span class="p">,</span> <span class="n">_heartbeat_listener</span><span class="p">)</span>
</span><span id="Vehicle-111"><a href="#Vehicle-111"><span class="linenos">111</span></a>
</span><span id="Vehicle-112"><a href="#Vehicle-112"><span class="linenos">112</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_abort_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle-113"><a href="#Vehicle-113"><span class="linenos">113</span></a>            <span class="c1"># TODO abort logic is more complicated :P</span>
</span><span id="Vehicle-114"><a href="#Vehicle-114"><span class="linenos">114</span></a>            <span class="c1"># if value != &quot;GUIDED&quot;:</span>
</span><span id="Vehicle-115"><a href="#Vehicle-115"><span class="linenos">115</span></a>            <span class="c1">#     self._abort()</span>
</span><span id="Vehicle-116"><a href="#Vehicle-116"><span class="linenos">116</span></a>            <span class="k">return</span>
</span><span id="Vehicle-117"><a href="#Vehicle-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">_abort_listener</span><span class="p">)</span>
</span><span id="Vehicle-118"><a href="#Vehicle-118"><span class="linenos">118</span></a>
</span><span id="Vehicle-119"><a href="#Vehicle-119"><span class="linenos">119</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_nav_controller_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle-120"><a href="#Vehicle-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle-121"><a href="#Vehicle-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;NAV_CONTROLLER_OUTPUT&quot;</span><span class="p">,</span> <span class="n">_nav_controller_listener</span><span class="p">)</span>
</span><span id="Vehicle-122"><a href="#Vehicle-122"><span class="linenos">122</span></a>
</span><span id="Vehicle-123"><a href="#Vehicle-123"><span class="linenos">123</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_mission_item_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle-124"><a href="#Vehicle-124"><span class="linenos">124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle-125"><a href="#Vehicle-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;MISSION_ITEM_INT&quot;</span><span class="p">,</span> <span class="n">_mission_item_listener</span><span class="p">)</span>
</span><span id="Vehicle-126"><a href="#Vehicle-126"><span class="linenos">126</span></a>
</span><span id="Vehicle-127"><a href="#Vehicle-127"><span class="linenos">127</span></a>        <span class="c1"># start separate thread for internal update support (not ideal, but can&#39;t think of an asyncio way)</span>
</span><span id="Vehicle-128"><a href="#Vehicle-128"><span class="linenos">128</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_update_loop</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vehicle-129"><a href="#Vehicle-129"><span class="linenos">129</span></a>        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="Vehicle-130"><a href="#Vehicle-130"><span class="linenos">130</span></a>
</span><span id="Vehicle-131"><a href="#Vehicle-131"><span class="linenos">131</span></a>        <span class="c1"># wait for connection</span>
</span><span id="Vehicle-132"><a href="#Vehicle-132"><span class="linenos">132</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle-133"><a href="#Vehicle-133"><span class="linenos">133</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-134"><a href="#Vehicle-134"><span class="linenos">134</span></a>
</span><span id="Vehicle-135"><a href="#Vehicle-135"><span class="linenos">135</span></a>    <span class="c1"># nouns</span>
</span><span id="Vehicle-136"><a href="#Vehicle-136"><span class="linenos">136</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-137"><a href="#Vehicle-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle-138"><a href="#Vehicle-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-139"><a href="#Vehicle-139"><span class="linenos">139</span></a><span class="sd">        True if receiving heartbeats, False otherwise</span>
</span><span id="Vehicle-140"><a href="#Vehicle-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-141"><a href="#Vehicle-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span>
</span><span id="Vehicle-142"><a href="#Vehicle-142"><span class="linenos">142</span></a>
</span><span id="Vehicle-143"><a href="#Vehicle-143"><span class="linenos">143</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-144"><a href="#Vehicle-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="Vehicle-145"><a href="#Vehicle-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-146"><a href="#Vehicle-146"><span class="linenos">146</span></a><span class="sd">        Get the current position of the Vehicle as a `util.Coordinate`</span>
</span><span id="Vehicle-147"><a href="#Vehicle-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-148"><a href="#Vehicle-148"><span class="linenos">148</span></a>        <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_relative_frame</span>
</span><span id="Vehicle-149"><a href="#Vehicle-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>
</span><span id="Vehicle-150"><a href="#Vehicle-150"><span class="linenos">150</span></a>
</span><span id="Vehicle-151"><a href="#Vehicle-151"><span class="linenos">151</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-152"><a href="#Vehicle-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">battery</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Battery</span><span class="p">:</span>
</span><span id="Vehicle-153"><a href="#Vehicle-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-154"><a href="#Vehicle-154"><span class="linenos">154</span></a><span class="sd">        Get the status of the battery. Wraps `dronekit.Battery`, which makes</span>
</span><span id="Vehicle-155"><a href="#Vehicle-155"><span class="linenos">155</span></a><span class="sd">        the `voltage`, `current`, and `level` available</span>
</span><span id="Vehicle-156"><a href="#Vehicle-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-157"><a href="#Vehicle-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">battery</span>
</span><span id="Vehicle-158"><a href="#Vehicle-158"><span class="linenos">158</span></a>
</span><span id="Vehicle-159"><a href="#Vehicle-159"><span class="linenos">159</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-160"><a href="#Vehicle-160"><span class="linenos">160</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">GPSInfo</span><span class="p">:</span>
</span><span id="Vehicle-161"><a href="#Vehicle-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-162"><a href="#Vehicle-162"><span class="linenos">162</span></a><span class="sd">        Get the current GPS status (for gps_0 -- can be changed in the future).</span>
</span><span id="Vehicle-163"><a href="#Vehicle-163"><span class="linenos">163</span></a><span class="sd">        Wraps `dronekit.GPSInfo`, which exposes the `fix_type` (0-1: no fix,</span>
</span><span id="Vehicle-164"><a href="#Vehicle-164"><span class="linenos">164</span></a><span class="sd">        2: 2d fix, 3: 3d fix), and number of `satellites_visible`, among other</span>
</span><span id="Vehicle-165"><a href="#Vehicle-165"><span class="linenos">165</span></a><span class="sd">        things.</span>
</span><span id="Vehicle-166"><a href="#Vehicle-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-167"><a href="#Vehicle-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">gps_0</span>
</span><span id="Vehicle-168"><a href="#Vehicle-168"><span class="linenos">168</span></a>
</span><span id="Vehicle-169"><a href="#Vehicle-169"><span class="linenos">169</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-170"><a href="#Vehicle-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">armed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle-171"><a href="#Vehicle-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span>
</span><span id="Vehicle-172"><a href="#Vehicle-172"><span class="linenos">172</span></a>
</span><span id="Vehicle-173"><a href="#Vehicle-173"><span class="linenos">173</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-174"><a href="#Vehicle-174"><span class="linenos">174</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">home_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="Vehicle-175"><a href="#Vehicle-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_home_location</span>
</span><span id="Vehicle-176"><a href="#Vehicle-176"><span class="linenos">176</span></a>    
</span><span id="Vehicle-177"><a href="#Vehicle-177"><span class="linenos">177</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-178"><a href="#Vehicle-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Vehicle-179"><a href="#Vehicle-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">heading</span>
</span><span id="Vehicle-180"><a href="#Vehicle-180"><span class="linenos">180</span></a>
</span><span id="Vehicle-181"><a href="#Vehicle-181"><span class="linenos">181</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-182"><a href="#Vehicle-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">:</span>
</span><span id="Vehicle-183"><a href="#Vehicle-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
</span><span id="Vehicle-184"><a href="#Vehicle-184"><span class="linenos">184</span></a>
</span><span id="Vehicle-185"><a href="#Vehicle-185"><span class="linenos">185</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-186"><a href="#Vehicle-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">autopilot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
</span><span id="Vehicle-187"><a href="#Vehicle-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">version</span>
</span><span id="Vehicle-188"><a href="#Vehicle-188"><span class="linenos">188</span></a>
</span><span id="Vehicle-189"><a href="#Vehicle-189"><span class="linenos">189</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle-190"><a href="#Vehicle-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">attitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Attitude</span><span class="p">:</span>
</span><span id="Vehicle-191"><a href="#Vehicle-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-192"><a href="#Vehicle-192"><span class="linenos">192</span></a><span class="sd">        attitude of the vehicle, all values in radians</span>
</span><span id="Vehicle-193"><a href="#Vehicle-193"><span class="linenos">193</span></a>
</span><span id="Vehicle-194"><a href="#Vehicle-194"><span class="linenos">194</span></a><span class="sd">        - pitch/roll are horizon-relative</span>
</span><span id="Vehicle-195"><a href="#Vehicle-195"><span class="linenos">195</span></a><span class="sd">        - yaw is world relative (north=0)</span>
</span><span id="Vehicle-196"><a href="#Vehicle-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-197"><a href="#Vehicle-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">attitude</span>
</span><span id="Vehicle-198"><a href="#Vehicle-198"><span class="linenos">198</span></a>    
</span><span id="Vehicle-199"><a href="#Vehicle-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vehicle-200"><a href="#Vehicle-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-201"><a href="#Vehicle-201"><span class="linenos">201</span></a><span class="sd">        Dump various properties collected by this vehicle and the underlying dronekit</span>
</span><span id="Vehicle-202"><a href="#Vehicle-202"><span class="linenos">202</span></a><span class="sd">        vehicle type to a string for logging/debug purposes.</span>
</span><span id="Vehicle-203"><a href="#Vehicle-203"><span class="linenos">203</span></a>
</span><span id="Vehicle-204"><a href="#Vehicle-204"><span class="linenos">204</span></a><span class="sd">        Serialization is handled by this function, call it to get an idea of the output</span>
</span><span id="Vehicle-205"><a href="#Vehicle-205"><span class="linenos">205</span></a><span class="sd">        format.</span>
</span><span id="Vehicle-206"><a href="#Vehicle-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-207"><a href="#Vehicle-207"><span class="linenos">207</span></a>        <span class="c1"># TODO provide a deserialization function in util.py for this output</span>
</span><span id="Vehicle-208"><a href="#Vehicle-208"><span class="linenos">208</span></a>        <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Vehicle-209"><a href="#Vehicle-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vehicle-210"><a href="#Vehicle-210"><span class="linenos">210</span></a>            <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Vehicle-211"><a href="#Vehicle-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_roll</span><span class="p">,</span>
</span><span id="Vehicle-212"><a href="#Vehicle-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_pitch</span><span class="p">,</span>
</span><span id="Vehicle-213"><a href="#Vehicle-213"><span class="linenos">213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_bearing</span><span class="p">,</span>
</span><span id="Vehicle-214"><a href="#Vehicle-214"><span class="linenos">214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">target_bearing</span><span class="p">,</span>
</span><span id="Vehicle-215"><a href="#Vehicle-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">wp_dist</span><span class="p">,</span>
</span><span id="Vehicle-216"><a href="#Vehicle-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">alt_error</span><span class="p">,</span>
</span><span id="Vehicle-217"><a href="#Vehicle-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">aspd_error</span><span class="p">,</span>
</span><span id="Vehicle-218"><a href="#Vehicle-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">xtrack_error</span><span class="p">,</span>
</span><span id="Vehicle-219"><a href="#Vehicle-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="Vehicle-220"><a href="#Vehicle-220"><span class="linenos">220</span></a>        
</span><span id="Vehicle-221"><a href="#Vehicle-221"><span class="linenos">221</span></a>        <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Vehicle-222"><a href="#Vehicle-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vehicle-223"><a href="#Vehicle-223"><span class="linenos">223</span></a>            <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Vehicle-224"><a href="#Vehicle-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
</span><span id="Vehicle-225"><a href="#Vehicle-225"><span class="linenos">225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span id="Vehicle-226"><a href="#Vehicle-226"><span class="linenos">226</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
</span><span id="Vehicle-227"><a href="#Vehicle-227"><span class="linenos">227</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
</span><span id="Vehicle-228"><a href="#Vehicle-228"><span class="linenos">228</span></a>            <span class="p">)</span>
</span><span id="Vehicle-229"><a href="#Vehicle-229"><span class="linenos">229</span></a>
</span><span id="Vehicle-230"><a href="#Vehicle-230"><span class="linenos">230</span></a>        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Vehicle-231"><a href="#Vehicle-231"><span class="linenos">231</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">(),</span>
</span><span id="Vehicle-232"><a href="#Vehicle-232"><span class="linenos">232</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">,</span>
</span><span id="Vehicle-233"><a href="#Vehicle-233"><span class="linenos">233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">attitude</span><span class="p">,</span>
</span><span id="Vehicle-234"><a href="#Vehicle-234"><span class="linenos">234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">autopilot_info</span><span class="p">,</span>
</span><span id="Vehicle-235"><a href="#Vehicle-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">battery</span><span class="p">,</span>
</span><span id="Vehicle-236"><a href="#Vehicle-236"><span class="linenos">236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gps</span><span class="p">,</span>
</span><span id="Vehicle-237"><a href="#Vehicle-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span>
</span><span id="Vehicle-238"><a href="#Vehicle-238"><span class="linenos">238</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">home_coords</span><span class="p">,</span>
</span><span id="Vehicle-239"><a href="#Vehicle-239"><span class="linenos">239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
</span><span id="Vehicle-240"><a href="#Vehicle-240"><span class="linenos">240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span>
</span><span id="Vehicle-241"><a href="#Vehicle-241"><span class="linenos">241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Vehicle-242"><a href="#Vehicle-242"><span class="linenos">242</span></a>            <span class="n">nav_controller_ouptut</span><span class="p">,</span>
</span><span id="Vehicle-243"><a href="#Vehicle-243"><span class="linenos">243</span></a>            <span class="n">mission_item_output</span><span class="p">,</span>
</span><span id="Vehicle-244"><a href="#Vehicle-244"><span class="linenos">244</span></a>        <span class="p">]</span>
</span><span id="Vehicle-245"><a href="#Vehicle-245"><span class="linenos">245</span></a>
</span><span id="Vehicle-246"><a href="#Vehicle-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">props</span><span class="p">))</span>
</span><span id="Vehicle-247"><a href="#Vehicle-247"><span class="linenos">247</span></a>
</span><span id="Vehicle-248"><a href="#Vehicle-248"><span class="linenos">248</span></a>    <span class="c1"># internal logic</span>
</span><span id="Vehicle-249"><a href="#Vehicle-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_update_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-250"><a href="#Vehicle-250"><span class="linenos">250</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Vehicle-251"><a href="#Vehicle-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_update</span><span class="p">()</span>
</span><span id="Vehicle-252"><a href="#Vehicle-252"><span class="linenos">252</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_INTERNAL_UPDATE_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-253"><a href="#Vehicle-253"><span class="linenos">253</span></a>
</span><span id="Vehicle-254"><a href="#Vehicle-254"><span class="linenos">254</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_internal_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-255"><a href="#Vehicle-255"><span class="linenos">255</span></a>        <span class="c1"># called regularly at some given frequency by an internal update loop (separate thread)</span>
</span><span id="Vehicle-256"><a href="#Vehicle-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_last_log_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_delay</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>
</span><span id="Vehicle-257"><a href="#Vehicle-257"><span class="linenos">257</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vehicle-258"><a href="#Vehicle-258"><span class="linenos">258</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="Vehicle-259"><a href="#Vehicle-259"><span class="linenos">259</span></a>            <span class="n">log_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_dump</span><span class="p">()</span>
</span><span id="Vehicle-260"><a href="#Vehicle-260"><span class="linenos">260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_file_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">log_output</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vehicle-261"><a href="#Vehicle-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_verbose_logging_last_log_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Vehicle-262"><a href="#Vehicle-262"><span class="linenos">262</span></a>    
</span><span id="Vehicle-263"><a href="#Vehicle-263"><span class="linenos">263</span></a>    <span class="c1"># special things</span>
</span><span id="Vehicle-264"><a href="#Vehicle-264"><span class="linenos">264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">done_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle-265"><a href="#Vehicle-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-266"><a href="#Vehicle-266"><span class="linenos">266</span></a><span class="sd">        See if the vehicle is ready to move (i.e. if the last movement command</span>
</span><span id="Vehicle-267"><a href="#Vehicle-267"><span class="linenos">267</span></a><span class="sd">        has been completed). Also makes sure that the vehicle is connected and</span>
</span><span id="Vehicle-268"><a href="#Vehicle-268"><span class="linenos">268</span></a><span class="sd">        that we haven&#39;t aborted.</span>
</span><span id="Vehicle-269"><a href="#Vehicle-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="Vehicle-270"><a href="#Vehicle-270"><span class="linenos">270</span></a><span class="sd">        This is more accurately a function that describes the vehicle&#39;s</span>
</span><span id="Vehicle-271"><a href="#Vehicle-271"><span class="linenos">271</span></a><span class="sd">        willingness to take a new command.</span>
</span><span id="Vehicle-272"><a href="#Vehicle-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-273"><a href="#Vehicle-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
</span><span id="Vehicle-274"><a href="#Vehicle-274"><span class="linenos">274</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Vehicle-275"><a href="#Vehicle-275"><span class="linenos">275</span></a>
</span><span id="Vehicle-276"><a href="#Vehicle-276"><span class="linenos">276</span></a>        <span class="c1"># syntax hack. functions and methods are different and need to be called</span>
</span><span id="Vehicle-277"><a href="#Vehicle-277"><span class="linenos">277</span></a>        <span class="c1"># differently to prevent them from being bound to self</span>
</span><span id="Vehicle-278"><a href="#Vehicle-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">,</span> <span class="s2">&quot;__func__&quot;</span><span class="p">):</span>        <span class="c1"># method</span>
</span><span id="Vehicle-279"><a href="#Vehicle-279"><span class="linenos">279</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="o">.</span><span class="vm">__func__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Vehicle-280"><a href="#Vehicle-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                    <span class="c1"># function</span>
</span><span id="Vehicle-281"><a href="#Vehicle-281"><span class="linenos">281</span></a>    
</span><span id="Vehicle-282"><a href="#Vehicle-282"><span class="linenos">282</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">await_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-283"><a href="#Vehicle-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-284"><a href="#Vehicle-284"><span class="linenos">284</span></a><span class="sd">        Helper function that blocks execution and waits for the vehicle to</span>
</span><span id="Vehicle-285"><a href="#Vehicle-285"><span class="linenos">285</span></a><span class="sd">        finish the current action/movement that it was instructed to do.</span>
</span><span id="Vehicle-286"><a href="#Vehicle-286"><span class="linenos">286</span></a>
</span><span id="Vehicle-287"><a href="#Vehicle-287"><span class="linenos">287</span></a><span class="sd">        Makes use of `Vehicle.done_moving`</span>
</span><span id="Vehicle-288"><a href="#Vehicle-288"><span class="linenos">288</span></a>
</span><span id="Vehicle-289"><a href="#Vehicle-289"><span class="linenos">289</span></a><span class="sd">        Additionally, will block and request arming if the vehicle isn&#39;t yet</span>
</span><span id="Vehicle-290"><a href="#Vehicle-290"><span class="linenos">290</span></a><span class="sd">        armed.</span>
</span><span id="Vehicle-291"><a href="#Vehicle-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-292"><a href="#Vehicle-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
</span><span id="Vehicle-293"><a href="#Vehicle-293"><span class="linenos">293</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_postarm</span><span class="p">()</span> <span class="c1"># also contains logic to wait for arm</span>
</span><span id="Vehicle-294"><a href="#Vehicle-294"><span class="linenos">294</span></a>        
</span><span id="Vehicle-295"><a href="#Vehicle-295"><span class="linenos">295</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done_moving</span><span class="p">():</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-296"><a href="#Vehicle-296"><span class="linenos">296</span></a>
</span><span id="Vehicle-297"><a href="#Vehicle-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-298"><a href="#Vehicle-298"><span class="linenos">298</span></a>        <span class="c1"># TODO this should be something different in the future.</span>
</span><span id="Vehicle-299"><a href="#Vehicle-299"><span class="linenos">299</span></a>        <span class="c1"># the intent of it in the past has been blocking further execution of</span>
</span><span id="Vehicle-300"><a href="#Vehicle-300"><span class="linenos">300</span></a>        <span class="c1"># more vehicle control logic.</span>
</span><span id="Vehicle-301"><a href="#Vehicle-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span><span class="p">:</span>
</span><span id="Vehicle-302"><a href="#Vehicle-302"><span class="linenos">302</span></a>            <span class="n">AERPAW_Platform</span><span class="o">.</span><span class="n">log_to_oeo</span><span class="p">(</span><span class="s2">&quot;[aerpawlib] Aborted.&quot;</span><span class="p">)</span>
</span><span id="Vehicle-303"><a href="#Vehicle-303"><span class="linenos">303</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vehicle-304"><a href="#Vehicle-304"><span class="linenos">304</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle-305"><a href="#Vehicle-305"><span class="linenos">305</span></a>
</span><span id="Vehicle-306"><a href="#Vehicle-306"><span class="linenos">306</span></a>    <span class="c1"># verbs</span>
</span><span id="Vehicle-307"><a href="#Vehicle-307"><span class="linenos">307</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-308"><a href="#Vehicle-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-309"><a href="#Vehicle-309"><span class="linenos">309</span></a><span class="sd">        Clean up the `Vehicle` object/any state</span>
</span><span id="Vehicle-310"><a href="#Vehicle-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-311"><a href="#Vehicle-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Vehicle-312"><a href="#Vehicle-312"><span class="linenos">312</span></a>
</span><span id="Vehicle-313"><a href="#Vehicle-313"><span class="linenos">313</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_armed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Vehicle-314"><a href="#Vehicle-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-315"><a href="#Vehicle-315"><span class="linenos">315</span></a><span class="sd">        Arm or disarm this vehicle, and wait for it to be armed (if possible)</span>
</span><span id="Vehicle-316"><a href="#Vehicle-316"><span class="linenos">316</span></a>
</span><span id="Vehicle-317"><a href="#Vehicle-317"><span class="linenos">317</span></a><span class="sd">        Dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at</span>
</span><span id="Vehicle-318"><a href="#Vehicle-318"><span class="linenos">318</span></a><span class="sd">        all!), so this will block execution until the vehicle has been armed.</span>
</span><span id="Vehicle-319"><a href="#Vehicle-319"><span class="linenos">319</span></a>
</span><span id="Vehicle-320"><a href="#Vehicle-320"><span class="linenos">320</span></a><span class="sd">        If the vehicle can&#39;t be armed, an Exception is raised.</span>
</span><span id="Vehicle-321"><a href="#Vehicle-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-322"><a href="#Vehicle-322"><span class="linenos">322</span></a>        <span class="c1"># dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at all!)</span>
</span><span id="Vehicle-323"><a href="#Vehicle-323"><span class="linenos">323</span></a>        <span class="c1"># this pattern keeps the funky logic out of the experimenter&#39;s script</span>
</span><span id="Vehicle-324"><a href="#Vehicle-324"><span class="linenos">324</span></a>        <span class="c1"># to make sure that things are safer overall</span>
</span><span id="Vehicle-325"><a href="#Vehicle-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span>
</span><span id="Vehicle-326"><a href="#Vehicle-326"><span class="linenos">326</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not ready to arm&quot;</span><span class="p">)</span> <span class="c1"># in this case, the script dies completely</span>
</span><span id="Vehicle-327"><a href="#Vehicle-327"><span class="linenos">327</span></a>                                                <span class="c1"># obviously not optimal *unless* we are</span>
</span><span id="Vehicle-328"><a href="#Vehicle-328"><span class="linenos">328</span></a>                                                <span class="c1"># certain that a scipt always arms once</span>
</span><span id="Vehicle-329"><a href="#Vehicle-329"><span class="linenos">329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle-330"><a href="#Vehicle-330"><span class="linenos">330</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-331"><a href="#Vehicle-331"><span class="linenos">331</span></a>    
</span><span id="Vehicle-332"><a href="#Vehicle-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_prearm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">should_postarm_init</span><span class="p">):</span>
</span><span id="Vehicle-333"><a href="#Vehicle-333"><span class="linenos">333</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">system_status</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;STANDBY&quot;</span><span class="p">,</span> <span class="s2">&quot;ACTIVE&quot;</span><span class="p">]:</span> <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-334"><a href="#Vehicle-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span> <span class="o">=</span> <span class="n">should_postarm_init</span>
</span><span id="Vehicle-335"><a href="#Vehicle-335"><span class="linenos">335</span></a>
</span><span id="Vehicle-336"><a href="#Vehicle-336"><span class="linenos">336</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_postarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-337"><a href="#Vehicle-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-338"><a href="#Vehicle-338"><span class="linenos">338</span></a><span class="sd">        Generic pre-mission manipulation of the vehicle into a state that is</span>
</span><span id="Vehicle-339"><a href="#Vehicle-339"><span class="linenos">339</span></a><span class="sd">        acceptable. MUST be called before anything else. Though this is done by</span>
</span><span id="Vehicle-340"><a href="#Vehicle-340"><span class="linenos">340</span></a><span class="sd">        the runner.</span>
</span><span id="Vehicle-341"><a href="#Vehicle-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-342"><a href="#Vehicle-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span><span class="p">:</span>
</span><span id="Vehicle-343"><a href="#Vehicle-343"><span class="linenos">343</span></a>            <span class="k">return</span>
</span><span id="Vehicle-344"><a href="#Vehicle-344"><span class="linenos">344</span></a>
</span><span id="Vehicle-345"><a href="#Vehicle-345"><span class="linenos">345</span></a>        <span class="n">AERPAW_Platform</span><span class="o">.</span><span class="n">log_to_oeo</span><span class="p">(</span><span class="s2">&quot;[aerpawlib] Guided command attempted. Waiting for safety pilot to arm&quot;</span><span class="p">)</span>
</span><span id="Vehicle-346"><a href="#Vehicle-346"><span class="linenos">346</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-347"><a href="#Vehicle-347"><span class="linenos">347</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-348"><a href="#Vehicle-348"><span class="linenos">348</span></a>
</span><span id="Vehicle-349"><a href="#Vehicle-349"><span class="linenos">349</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_ARMING_SEQUENCE_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-350"><a href="#Vehicle-350"><span class="linenos">350</span></a>        
</span><span id="Vehicle-351"><a href="#Vehicle-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;GUIDED&quot;</span><span class="p">)</span>
</span><span id="Vehicle-352"><a href="#Vehicle-352"><span class="linenos">352</span></a>        
</span><span id="Vehicle-353"><a href="#Vehicle-353"><span class="linenos">353</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_ARMING_SEQUENCE_DELAY</span><span class="p">)</span>
</span><span id="Vehicle-354"><a href="#Vehicle-354"><span class="linenos">354</span></a>        
</span><span id="Vehicle-355"><a href="#Vehicle-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle-356"><a href="#Vehicle-356"><span class="linenos">356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_home_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
</span><span id="Vehicle-357"><a href="#Vehicle-357"><span class="linenos">357</span></a>    
</span><span id="Vehicle-358"><a href="#Vehicle-358"><span class="linenos">358</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vehicle-359"><a href="#Vehicle-359"><span class="linenos">359</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Vehicle-360"><a href="#Vehicle-360"><span class="linenos">360</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Vehicle-361"><a href="#Vehicle-361"><span class="linenos">361</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Vehicle-362"><a href="#Vehicle-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-363"><a href="#Vehicle-363"><span class="linenos">363</span></a><span class="sd">        Make the vehicle go to provided coordinates.</span>
</span><span id="Vehicle-364"><a href="#Vehicle-364"><span class="linenos">364</span></a>
</span><span id="Vehicle-365"><a href="#Vehicle-365"><span class="linenos">365</span></a><span class="sd">        `tolerance` is the min distance away from the coordinates, in meters,</span>
</span><span id="Vehicle-366"><a href="#Vehicle-366"><span class="linenos">366</span></a><span class="sd">        that is acceptable.</span>
</span><span id="Vehicle-367"><a href="#Vehicle-367"><span class="linenos">367</span></a>
</span><span id="Vehicle-368"><a href="#Vehicle-368"><span class="linenos">368</span></a><span class="sd">        `target_heading`, when set, will make the drone point in the specified</span>
</span><span id="Vehicle-369"><a href="#Vehicle-369"><span class="linenos">369</span></a><span class="sd">        direction (absolute). Otherwise the drone will remain pointing in the</span>
</span><span id="Vehicle-370"><a href="#Vehicle-370"><span class="linenos">370</span></a><span class="sd">        current direction. This is only available on drones.</span>
</span><span id="Vehicle-371"><a href="#Vehicle-371"><span class="linenos">371</span></a>
</span><span id="Vehicle-372"><a href="#Vehicle-372"><span class="linenos">372</span></a><span class="sd">        This method is only available for vehicles built off the `Vehicle` type</span>
</span><span id="Vehicle-373"><a href="#Vehicle-373"><span class="linenos">373</span></a><span class="sd">        (ex: `Drone` or `Rover`)</span>
</span><span id="Vehicle-374"><a href="#Vehicle-374"><span class="linenos">374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-375"><a href="#Vehicle-375"><span class="linenos">375</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Generic vehicles can&#39;t go to coordinates!&quot;</span><span class="p">)</span>
</span><span id="Vehicle-376"><a href="#Vehicle-376"><span class="linenos">376</span></a>
</span><span id="Vehicle-377"><a href="#Vehicle-377"><span class="linenos">377</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vehicle-378"><a href="#Vehicle-378"><span class="linenos">378</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="Vehicle-379"><a href="#Vehicle-379"><span class="linenos">379</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Vehicle-380"><a href="#Vehicle-380"><span class="linenos">380</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Vehicle-381"><a href="#Vehicle-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-382"><a href="#Vehicle-382"><span class="linenos">382</span></a><span class="sd">        Set a drone&#39;s velocity that it will use for `duration` seconds.</span>
</span><span id="Vehicle-383"><a href="#Vehicle-383"><span class="linenos">383</span></a>
</span><span id="Vehicle-384"><a href="#Vehicle-384"><span class="linenos">384</span></a><span class="sd">        The velocity vector provided will be inerpreted as being global</span>
</span><span id="Vehicle-385"><a href="#Vehicle-385"><span class="linenos">385</span></a><span class="sd">        relative *in direction* unless the `global_relative` parameter is set</span>
</span><span id="Vehicle-386"><a href="#Vehicle-386"><span class="linenos">386</span></a><span class="sd">        to False.</span>
</span><span id="Vehicle-387"><a href="#Vehicle-387"><span class="linenos">387</span></a>
</span><span id="Vehicle-388"><a href="#Vehicle-388"><span class="linenos">388</span></a><span class="sd">        The vehicle will maintain this velocity for `duration` seconds, if</span>
</span><span id="Vehicle-389"><a href="#Vehicle-389"><span class="linenos">389</span></a><span class="sd">        `duration` is provided, otherwise it will automatically maintain the</span>
</span><span id="Vehicle-390"><a href="#Vehicle-390"><span class="linenos">390</span></a><span class="sd">        specified velocity until another command is sent.</span>
</span><span id="Vehicle-391"><a href="#Vehicle-391"><span class="linenos">391</span></a>
</span><span id="Vehicle-392"><a href="#Vehicle-392"><span class="linenos">392</span></a><span class="sd">        The vehicle&#39;s velocity vector, if it has a magnitude greater than the</span>
</span><span id="Vehicle-393"><a href="#Vehicle-393"><span class="linenos">393</span></a><span class="sd">        configured &quot;max_velocity&quot; (configurable in aerpawlib by using a config.yaml</span>
</span><span id="Vehicle-394"><a href="#Vehicle-394"><span class="linenos">394</span></a><span class="sd">        file with the --vehicle-config argument, defaults to 5 m/s), will be</span>
</span><span id="Vehicle-395"><a href="#Vehicle-395"><span class="linenos">395</span></a><span class="sd">        normalized and rescaled such that the new magnitude is equal to the</span>
</span><span id="Vehicle-396"><a href="#Vehicle-396"><span class="linenos">396</span></a><span class="sd">        maximum velocity.</span>
</span><span id="Vehicle-397"><a href="#Vehicle-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-398"><a href="#Vehicle-398"><span class="linenos">398</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;set_velocity not implemented&quot;</span><span class="p">)</span>
</span><span id="Vehicle-399"><a href="#Vehicle-399"><span class="linenos">399</span></a>
</span><span id="Vehicle-400"><a href="#Vehicle-400"><span class="linenos">400</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_groundspeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Vehicle-401"><a href="#Vehicle-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-402"><a href="#Vehicle-402"><span class="linenos">402</span></a><span class="sd">        Set a vehicle&#39;s cruise velocity as used by the autopilot when performing</span>
</span><span id="Vehicle-403"><a href="#Vehicle-403"><span class="linenos">403</span></a><span class="sd">        guided movement operations (ex: goto_coordinates). In m/s.</span>
</span><span id="Vehicle-404"><a href="#Vehicle-404"><span class="linenos">404</span></a>
</span><span id="Vehicle-405"><a href="#Vehicle-405"><span class="linenos">405</span></a><span class="sd">        NOTE:</span>
</span><span id="Vehicle-406"><a href="#Vehicle-406"><span class="linenos">406</span></a><span class="sd">            This is not always respected by the autopilot and will not succeed</span>
</span><span id="Vehicle-407"><a href="#Vehicle-407"><span class="linenos">407</span></a><span class="sd">            on rover type vehicles in simulation.</span>
</span><span id="Vehicle-408"><a href="#Vehicle-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-409"><a href="#Vehicle-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">groundspeed</span> <span class="o">=</span> <span class="n">velocity</span>
</span><span id="Vehicle-410"><a href="#Vehicle-410"><span class="linenos">410</span></a>    
</span><span id="Vehicle-411"><a href="#Vehicle-411"><span class="linenos">411</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle-412"><a href="#Vehicle-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle-413"><a href="#Vehicle-413"><span class="linenos">413</span></a><span class="sd">        Internal utility to stop any movement being run in the background. This</span>
</span><span id="Vehicle-414"><a href="#Vehicle-414"><span class="linenos">414</span></a><span class="sd">        ignores await_ready_to_move(). Requires set_velocity to be implemented</span>
</span><span id="Vehicle-415"><a href="#Vehicle-415"><span class="linenos">415</span></a><span class="sd">        for the given vehicle.</span>
</span><span id="Vehicle-416"><a href="#Vehicle-416"><span class="linenos">416</span></a>
</span><span id="Vehicle-417"><a href="#Vehicle-417"><span class="linenos">417</span></a><span class="sd">        TODO needs testing. setting velocity to 0\bar may not be best way to</span>
</span><span id="Vehicle-418"><a href="#Vehicle-418"><span class="linenos">418</span></a><span class="sd">        stop</span>
</span><span id="Vehicle-419"><a href="#Vehicle-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle-420"><a href="#Vehicle-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Overarching "generic vehicle" type. Implements all functionality, excluding
movement commands (which are <em>always</em> vehicle specific).</p>
</div>


                            <div id="Vehicle.__init__" class="classattr">
                                        <input id="Vehicle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Vehicle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="Vehicle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.__init__-87"><a href="#Vehicle.__init__-87"><span class="linenos"> 87</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vehicle.__init__-88"><a href="#Vehicle.__init__-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">,</span> <span class="n">wait_ready</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vehicle.__init__-89"><a href="#Vehicle.__init__-89"><span class="linenos"> 89</span></a>        
</span><span id="Vehicle.__init__-90"><a href="#Vehicle.__init__-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</span><span id="Vehicle.__init__-91"><a href="#Vehicle.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">wait_ready</span><span class="p">()</span> <span class="c1"># we need to do this to capture</span>
</span><span id="Vehicle.__init__-92"><a href="#Vehicle.__init__-92"><span class="linenos"> 92</span></a>                                            <span class="c1"># things such as the home location</span>
</span><span id="Vehicle.__init__-93"><a href="#Vehicle.__init__-93"><span class="linenos"> 93</span></a>        
</span><span id="Vehicle.__init__-94"><a href="#Vehicle.__init__-94"><span class="linenos"> 94</span></a>        <span class="c1"># # this hack is needed to wait for the autopilot to reply with all needed info for the runner</span>
</span><span id="Vehicle.__init__-95"><a href="#Vehicle.__init__-95"><span class="linenos"> 95</span></a>        <span class="c1"># while self.autopilot_info.major == None: time.sleep(0.5)</span>
</span><span id="Vehicle.__init__-96"><a href="#Vehicle.__init__-96"><span class="linenos"> 96</span></a>        
</span><span id="Vehicle.__init__-97"><a href="#Vehicle.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vehicle.__init__-98"><a href="#Vehicle.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="Vehicle.__init__-99"><a href="#Vehicle.__init__-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_should_postarm_init</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle.__init__-100"><a href="#Vehicle.__init__-100"><span class="linenos">100</span></a>
</span><span id="Vehicle.__init__-101"><a href="#Vehicle.__init__-101"><span class="linenos">101</span></a>        <span class="c1"># time at which the vehicle received the first guided command (takeoff/goto)</span>
</span><span id="Vehicle.__init__-102"><a href="#Vehicle.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vehicle.__init__-103"><a href="#Vehicle.__init__-103"><span class="linenos">103</span></a>
</span><span id="Vehicle.__init__-104"><a href="#Vehicle.__init__-104"><span class="linenos">104</span></a>        <span class="c1"># register required listeners after connecting</span>
</span><span id="Vehicle.__init__-105"><a href="#Vehicle.__init__-105"><span class="linenos">105</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_heartbeat_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle.__init__-106"><a href="#Vehicle.__init__-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle.__init__-107"><a href="#Vehicle.__init__-107"><span class="linenos">107</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vehicle.__init__-108"><a href="#Vehicle.__init__-108"><span class="linenos">108</span></a>            <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle.__init__-109"><a href="#Vehicle.__init__-109"><span class="linenos">109</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vehicle.__init__-110"><a href="#Vehicle.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;last_heartbeat&quot;</span><span class="p">,</span> <span class="n">_heartbeat_listener</span><span class="p">)</span>
</span><span id="Vehicle.__init__-111"><a href="#Vehicle.__init__-111"><span class="linenos">111</span></a>
</span><span id="Vehicle.__init__-112"><a href="#Vehicle.__init__-112"><span class="linenos">112</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_abort_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle.__init__-113"><a href="#Vehicle.__init__-113"><span class="linenos">113</span></a>            <span class="c1"># TODO abort logic is more complicated :P</span>
</span><span id="Vehicle.__init__-114"><a href="#Vehicle.__init__-114"><span class="linenos">114</span></a>            <span class="c1"># if value != &quot;GUIDED&quot;:</span>
</span><span id="Vehicle.__init__-115"><a href="#Vehicle.__init__-115"><span class="linenos">115</span></a>            <span class="c1">#     self._abort()</span>
</span><span id="Vehicle.__init__-116"><a href="#Vehicle.__init__-116"><span class="linenos">116</span></a>            <span class="k">return</span>
</span><span id="Vehicle.__init__-117"><a href="#Vehicle.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_attribute_listener</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="n">_abort_listener</span><span class="p">)</span>
</span><span id="Vehicle.__init__-118"><a href="#Vehicle.__init__-118"><span class="linenos">118</span></a>
</span><span id="Vehicle.__init__-119"><a href="#Vehicle.__init__-119"><span class="linenos">119</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_nav_controller_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle.__init__-120"><a href="#Vehicle.__init__-120"><span class="linenos">120</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle.__init__-121"><a href="#Vehicle.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;NAV_CONTROLLER_OUTPUT&quot;</span><span class="p">,</span> <span class="n">_nav_controller_listener</span><span class="p">)</span>
</span><span id="Vehicle.__init__-122"><a href="#Vehicle.__init__-122"><span class="linenos">122</span></a>
</span><span id="Vehicle.__init__-123"><a href="#Vehicle.__init__-123"><span class="linenos">123</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_mission_item_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Vehicle.__init__-124"><a href="#Vehicle.__init__-124"><span class="linenos">124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle.__init__-125"><a href="#Vehicle.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;MISSION_ITEM_INT&quot;</span><span class="p">,</span> <span class="n">_mission_item_listener</span><span class="p">)</span>
</span><span id="Vehicle.__init__-126"><a href="#Vehicle.__init__-126"><span class="linenos">126</span></a>
</span><span id="Vehicle.__init__-127"><a href="#Vehicle.__init__-127"><span class="linenos">127</span></a>        <span class="c1"># start separate thread for internal update support (not ideal, but can&#39;t think of an asyncio way)</span>
</span><span id="Vehicle.__init__-128"><a href="#Vehicle.__init__-128"><span class="linenos">128</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_internal_update_loop</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vehicle.__init__-129"><a href="#Vehicle.__init__-129"><span class="linenos">129</span></a>        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="Vehicle.__init__-130"><a href="#Vehicle.__init__-130"><span class="linenos">130</span></a>
</span><span id="Vehicle.__init__-131"><a href="#Vehicle.__init__-131"><span class="linenos">131</span></a>        <span class="c1"># wait for connection</span>
</span><span id="Vehicle.__init__-132"><a href="#Vehicle.__init__-132"><span class="linenos">132</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span><span class="p">:</span>
</span><span id="Vehicle.__init__-133"><a href="#Vehicle.__init__-133"><span class="linenos">133</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.connected" class="classattr">
                                        <input id="Vehicle.connected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">connected</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="Vehicle.connected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.connected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.connected-136"><a href="#Vehicle.connected-136"><span class="linenos">136</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.connected-137"><a href="#Vehicle.connected-137"><span class="linenos">137</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle.connected-138"><a href="#Vehicle.connected-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.connected-139"><a href="#Vehicle.connected-139"><span class="linenos">139</span></a><span class="sd">        True if receiving heartbeats, False otherwise</span>
</span><span id="Vehicle.connected-140"><a href="#Vehicle.connected-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.connected-141"><a href="#Vehicle.connected-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_heartbeat</span>
</span></pre></div>


            <div class="docstring"><p>True if receiving heartbeats, False otherwise</p>
</div>


                            </div>
                            <div id="Vehicle.position" class="classattr">
                                        <input id="Vehicle.position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">position</span><span class="annotation">: <a href="util.html#Coordinate">aerpawlib.util.Coordinate</a></span>

                <label class="view-source-button" for="Vehicle.position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.position-143"><a href="#Vehicle.position-143"><span class="linenos">143</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.position-144"><a href="#Vehicle.position-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="Vehicle.position-145"><a href="#Vehicle.position-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.position-146"><a href="#Vehicle.position-146"><span class="linenos">146</span></a><span class="sd">        Get the current position of the Vehicle as a `util.Coordinate`</span>
</span><span id="Vehicle.position-147"><a href="#Vehicle.position-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.position-148"><a href="#Vehicle.position-148"><span class="linenos">148</span></a>        <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">global_relative_frame</span>
</span><span id="Vehicle.position-149"><a href="#Vehicle.position-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">alt</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the current position of the Vehicle as a <code>util.Coordinate</code></p>
</div>


                            </div>
                            <div id="Vehicle.battery" class="classattr">
                                        <input id="Vehicle.battery-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">battery</span><span class="annotation">: dronekit.Battery</span>

                <label class="view-source-button" for="Vehicle.battery-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.battery"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.battery-151"><a href="#Vehicle.battery-151"><span class="linenos">151</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.battery-152"><a href="#Vehicle.battery-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">battery</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Battery</span><span class="p">:</span>
</span><span id="Vehicle.battery-153"><a href="#Vehicle.battery-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.battery-154"><a href="#Vehicle.battery-154"><span class="linenos">154</span></a><span class="sd">        Get the status of the battery. Wraps `dronekit.Battery`, which makes</span>
</span><span id="Vehicle.battery-155"><a href="#Vehicle.battery-155"><span class="linenos">155</span></a><span class="sd">        the `voltage`, `current`, and `level` available</span>
</span><span id="Vehicle.battery-156"><a href="#Vehicle.battery-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.battery-157"><a href="#Vehicle.battery-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">battery</span>
</span></pre></div>


            <div class="docstring"><p>Get the status of the battery. Wraps <code>dronekit.Battery</code>, which makes
the <code>voltage</code>, <code>current</code>, and <code>level</code> available</p>
</div>


                            </div>
                            <div id="Vehicle.gps" class="classattr">
                                        <input id="Vehicle.gps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">gps</span><span class="annotation">: dronekit.GPSInfo</span>

                <label class="view-source-button" for="Vehicle.gps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.gps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.gps-159"><a href="#Vehicle.gps-159"><span class="linenos">159</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.gps-160"><a href="#Vehicle.gps-160"><span class="linenos">160</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">GPSInfo</span><span class="p">:</span>
</span><span id="Vehicle.gps-161"><a href="#Vehicle.gps-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.gps-162"><a href="#Vehicle.gps-162"><span class="linenos">162</span></a><span class="sd">        Get the current GPS status (for gps_0 -- can be changed in the future).</span>
</span><span id="Vehicle.gps-163"><a href="#Vehicle.gps-163"><span class="linenos">163</span></a><span class="sd">        Wraps `dronekit.GPSInfo`, which exposes the `fix_type` (0-1: no fix,</span>
</span><span id="Vehicle.gps-164"><a href="#Vehicle.gps-164"><span class="linenos">164</span></a><span class="sd">        2: 2d fix, 3: 3d fix), and number of `satellites_visible`, among other</span>
</span><span id="Vehicle.gps-165"><a href="#Vehicle.gps-165"><span class="linenos">165</span></a><span class="sd">        things.</span>
</span><span id="Vehicle.gps-166"><a href="#Vehicle.gps-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.gps-167"><a href="#Vehicle.gps-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">gps_0</span>
</span></pre></div>


            <div class="docstring"><p>Get the current GPS status (for gps_0 -- can be changed in the future).
Wraps <code>dronekit.GPSInfo</code>, which exposes the <code>fix_type</code> (0-1: no fix,
2: 2d fix, 3: 3d fix), and number of <code>satellites_visible</code>, among other
things.</p>
</div>


                            </div>
                            <div id="Vehicle.armed" class="classattr">
                                        <input id="Vehicle.armed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">armed</span><span class="annotation">: bool</span>

                <label class="view-source-button" for="Vehicle.armed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.armed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.armed-169"><a href="#Vehicle.armed-169"><span class="linenos">169</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.armed-170"><a href="#Vehicle.armed-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">armed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle.armed-171"><a href="#Vehicle.armed-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.home_coords" class="classattr">
                                        <input id="Vehicle.home_coords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">home_coords</span><span class="annotation">: <a href="util.html#Coordinate">aerpawlib.util.Coordinate</a></span>

                <label class="view-source-button" for="Vehicle.home_coords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.home_coords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.home_coords-173"><a href="#Vehicle.home_coords-173"><span class="linenos">173</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.home_coords-174"><a href="#Vehicle.home_coords-174"><span class="linenos">174</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">home_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">:</span>
</span><span id="Vehicle.home_coords-175"><a href="#Vehicle.home_coords-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_home_location</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.heading" class="classattr">
                                        <input id="Vehicle.heading-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">heading</span><span class="annotation">: float</span>

                <label class="view-source-button" for="Vehicle.heading-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.heading"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.heading-177"><a href="#Vehicle.heading-177"><span class="linenos">177</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.heading-178"><a href="#Vehicle.heading-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Vehicle.heading-179"><a href="#Vehicle.heading-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">heading</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.velocity" class="classattr">
                                        <input id="Vehicle.velocity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">velocity</span><span class="annotation">: <a href="util.html#VectorNED">aerpawlib.util.VectorNED</a></span>

                <label class="view-source-button" for="Vehicle.velocity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.velocity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.velocity-181"><a href="#Vehicle.velocity-181"><span class="linenos">181</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.velocity-182"><a href="#Vehicle.velocity-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">:</span>
</span><span id="Vehicle.velocity-183"><a href="#Vehicle.velocity-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">velocity</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.autopilot_info" class="classattr">
                                        <input id="Vehicle.autopilot_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">autopilot_info</span><span class="annotation">: dronekit.Version</span>

                <label class="view-source-button" for="Vehicle.autopilot_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.autopilot_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.autopilot_info-185"><a href="#Vehicle.autopilot_info-185"><span class="linenos">185</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.autopilot_info-186"><a href="#Vehicle.autopilot_info-186"><span class="linenos">186</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">autopilot_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Version</span><span class="p">:</span>
</span><span id="Vehicle.autopilot_info-187"><a href="#Vehicle.autopilot_info-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">version</span>
</span></pre></div>


    

                            </div>
                            <div id="Vehicle.attitude" class="classattr">
                                        <input id="Vehicle.attitude-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">attitude</span><span class="annotation">: dronekit.Attitude</span>

                <label class="view-source-button" for="Vehicle.attitude-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.attitude"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.attitude-189"><a href="#Vehicle.attitude-189"><span class="linenos">189</span></a>    <span class="nd">@property</span>
</span><span id="Vehicle.attitude-190"><a href="#Vehicle.attitude-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">attitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">Attitude</span><span class="p">:</span>
</span><span id="Vehicle.attitude-191"><a href="#Vehicle.attitude-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.attitude-192"><a href="#Vehicle.attitude-192"><span class="linenos">192</span></a><span class="sd">        attitude of the vehicle, all values in radians</span>
</span><span id="Vehicle.attitude-193"><a href="#Vehicle.attitude-193"><span class="linenos">193</span></a>
</span><span id="Vehicle.attitude-194"><a href="#Vehicle.attitude-194"><span class="linenos">194</span></a><span class="sd">        - pitch/roll are horizon-relative</span>
</span><span id="Vehicle.attitude-195"><a href="#Vehicle.attitude-195"><span class="linenos">195</span></a><span class="sd">        - yaw is world relative (north=0)</span>
</span><span id="Vehicle.attitude-196"><a href="#Vehicle.attitude-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.attitude-197"><a href="#Vehicle.attitude-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">attitude</span>
</span></pre></div>


            <div class="docstring"><p>attitude of the vehicle, all values in radians</p>

<ul>
<li>pitch/roll are horizon-relative</li>
<li>yaw is world relative (north=0)</li>
</ul>
</div>


                            </div>
                            <div id="Vehicle.debug_dump" class="classattr">
                                        <input id="Vehicle.debug_dump-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">debug_dump</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Vehicle.debug_dump-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.debug_dump"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.debug_dump-199"><a href="#Vehicle.debug_dump-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">debug_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vehicle.debug_dump-200"><a href="#Vehicle.debug_dump-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.debug_dump-201"><a href="#Vehicle.debug_dump-201"><span class="linenos">201</span></a><span class="sd">        Dump various properties collected by this vehicle and the underlying dronekit</span>
</span><span id="Vehicle.debug_dump-202"><a href="#Vehicle.debug_dump-202"><span class="linenos">202</span></a><span class="sd">        vehicle type to a string for logging/debug purposes.</span>
</span><span id="Vehicle.debug_dump-203"><a href="#Vehicle.debug_dump-203"><span class="linenos">203</span></a>
</span><span id="Vehicle.debug_dump-204"><a href="#Vehicle.debug_dump-204"><span class="linenos">204</span></a><span class="sd">        Serialization is handled by this function, call it to get an idea of the output</span>
</span><span id="Vehicle.debug_dump-205"><a href="#Vehicle.debug_dump-205"><span class="linenos">205</span></a><span class="sd">        format.</span>
</span><span id="Vehicle.debug_dump-206"><a href="#Vehicle.debug_dump-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.debug_dump-207"><a href="#Vehicle.debug_dump-207"><span class="linenos">207</span></a>        <span class="c1"># TODO provide a deserialization function in util.py for this output</span>
</span><span id="Vehicle.debug_dump-208"><a href="#Vehicle.debug_dump-208"><span class="linenos">208</span></a>        <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Vehicle.debug_dump-209"><a href="#Vehicle.debug_dump-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vehicle.debug_dump-210"><a href="#Vehicle.debug_dump-210"><span class="linenos">210</span></a>            <span class="n">nav_controller_ouptut</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Vehicle.debug_dump-211"><a href="#Vehicle.debug_dump-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_roll</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-212"><a href="#Vehicle.debug_dump-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_pitch</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-213"><a href="#Vehicle.debug_dump-213"><span class="linenos">213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">nav_bearing</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-214"><a href="#Vehicle.debug_dump-214"><span class="linenos">214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">target_bearing</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-215"><a href="#Vehicle.debug_dump-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">wp_dist</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-216"><a href="#Vehicle.debug_dump-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">alt_error</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-217"><a href="#Vehicle.debug_dump-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">aspd_error</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-218"><a href="#Vehicle.debug_dump-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_nav_controller_output</span><span class="o">.</span><span class="n">xtrack_error</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-219"><a href="#Vehicle.debug_dump-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="Vehicle.debug_dump-220"><a href="#Vehicle.debug_dump-220"><span class="linenos">220</span></a>        
</span><span id="Vehicle.debug_dump-221"><a href="#Vehicle.debug_dump-221"><span class="linenos">221</span></a>        <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Vehicle.debug_dump-222"><a href="#Vehicle.debug_dump-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vehicle.debug_dump-223"><a href="#Vehicle.debug_dump-223"><span class="linenos">223</span></a>            <span class="n">mission_item_output</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Vehicle.debug_dump-224"><a href="#Vehicle.debug_dump-224"><span class="linenos">224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-225"><a href="#Vehicle.debug_dump-225"><span class="linenos">225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-226"><a href="#Vehicle.debug_dump-226"><span class="linenos">226</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-227"><a href="#Vehicle.debug_dump-227"><span class="linenos">227</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_last_mission_item_int</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-228"><a href="#Vehicle.debug_dump-228"><span class="linenos">228</span></a>            <span class="p">)</span>
</span><span id="Vehicle.debug_dump-229"><a href="#Vehicle.debug_dump-229"><span class="linenos">229</span></a>
</span><span id="Vehicle.debug_dump-230"><a href="#Vehicle.debug_dump-230"><span class="linenos">230</span></a>        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Vehicle.debug_dump-231"><a href="#Vehicle.debug_dump-231"><span class="linenos">231</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">(),</span>
</span><span id="Vehicle.debug_dump-232"><a href="#Vehicle.debug_dump-232"><span class="linenos">232</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-233"><a href="#Vehicle.debug_dump-233"><span class="linenos">233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">attitude</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-234"><a href="#Vehicle.debug_dump-234"><span class="linenos">234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">autopilot_info</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-235"><a href="#Vehicle.debug_dump-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">battery</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-236"><a href="#Vehicle.debug_dump-236"><span class="linenos">236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gps</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-237"><a href="#Vehicle.debug_dump-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-238"><a href="#Vehicle.debug_dump-238"><span class="linenos">238</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">home_coords</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-239"><a href="#Vehicle.debug_dump-239"><span class="linenos">239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-240"><a href="#Vehicle.debug_dump-240"><span class="linenos">240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-241"><a href="#Vehicle.debug_dump-241"><span class="linenos">241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-242"><a href="#Vehicle.debug_dump-242"><span class="linenos">242</span></a>            <span class="n">nav_controller_ouptut</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-243"><a href="#Vehicle.debug_dump-243"><span class="linenos">243</span></a>            <span class="n">mission_item_output</span><span class="p">,</span>
</span><span id="Vehicle.debug_dump-244"><a href="#Vehicle.debug_dump-244"><span class="linenos">244</span></a>        <span class="p">]</span>
</span><span id="Vehicle.debug_dump-245"><a href="#Vehicle.debug_dump-245"><span class="linenos">245</span></a>
</span><span id="Vehicle.debug_dump-246"><a href="#Vehicle.debug_dump-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">props</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Dump various properties collected by this vehicle and the underlying dronekit
vehicle type to a string for logging/debug purposes.</p>

<p>Serialization is handled by this function, call it to get an idea of the output
format.</p>
</div>


                            </div>
                            <div id="Vehicle.done_moving" class="classattr">
                                        <input id="Vehicle.done_moving-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">done_moving</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Vehicle.done_moving-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.done_moving"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.done_moving-264"><a href="#Vehicle.done_moving-264"><span class="linenos">264</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">done_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vehicle.done_moving-265"><a href="#Vehicle.done_moving-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.done_moving-266"><a href="#Vehicle.done_moving-266"><span class="linenos">266</span></a><span class="sd">        See if the vehicle is ready to move (i.e. if the last movement command</span>
</span><span id="Vehicle.done_moving-267"><a href="#Vehicle.done_moving-267"><span class="linenos">267</span></a><span class="sd">        has been completed). Also makes sure that the vehicle is connected and</span>
</span><span id="Vehicle.done_moving-268"><a href="#Vehicle.done_moving-268"><span class="linenos">268</span></a><span class="sd">        that we haven&#39;t aborted.</span>
</span><span id="Vehicle.done_moving-269"><a href="#Vehicle.done_moving-269"><span class="linenos">269</span></a><span class="sd">        </span>
</span><span id="Vehicle.done_moving-270"><a href="#Vehicle.done_moving-270"><span class="linenos">270</span></a><span class="sd">        This is more accurately a function that describes the vehicle&#39;s</span>
</span><span id="Vehicle.done_moving-271"><a href="#Vehicle.done_moving-271"><span class="linenos">271</span></a><span class="sd">        willingness to take a new command.</span>
</span><span id="Vehicle.done_moving-272"><a href="#Vehicle.done_moving-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.done_moving-273"><a href="#Vehicle.done_moving-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aborted</span><span class="p">:</span>
</span><span id="Vehicle.done_moving-274"><a href="#Vehicle.done_moving-274"><span class="linenos">274</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Vehicle.done_moving-275"><a href="#Vehicle.done_moving-275"><span class="linenos">275</span></a>
</span><span id="Vehicle.done_moving-276"><a href="#Vehicle.done_moving-276"><span class="linenos">276</span></a>        <span class="c1"># syntax hack. functions and methods are different and need to be called</span>
</span><span id="Vehicle.done_moving-277"><a href="#Vehicle.done_moving-277"><span class="linenos">277</span></a>        <span class="c1"># differently to prevent them from being bound to self</span>
</span><span id="Vehicle.done_moving-278"><a href="#Vehicle.done_moving-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">,</span> <span class="s2">&quot;__func__&quot;</span><span class="p">):</span>        <span class="c1"># method</span>
</span><span id="Vehicle.done_moving-279"><a href="#Vehicle.done_moving-279"><span class="linenos">279</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="o">.</span><span class="vm">__func__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Vehicle.done_moving-280"><a href="#Vehicle.done_moving-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>                    <span class="c1"># function</span>
</span></pre></div>


            <div class="docstring"><p>See if the vehicle is ready to move (i.e. if the last movement command
has been completed). Also makes sure that the vehicle is connected and
that we haven't aborted.</p>

<p>This is more accurately a function that describes the vehicle's
willingness to take a new command.</p>
</div>


                            </div>
                            <div id="Vehicle.await_ready_to_move" class="classattr">
                                        <input id="Vehicle.await_ready_to_move-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">await_ready_to_move</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.await_ready_to_move-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.await_ready_to_move"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.await_ready_to_move-282"><a href="#Vehicle.await_ready_to_move-282"><span class="linenos">282</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">await_ready_to_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle.await_ready_to_move-283"><a href="#Vehicle.await_ready_to_move-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.await_ready_to_move-284"><a href="#Vehicle.await_ready_to_move-284"><span class="linenos">284</span></a><span class="sd">        Helper function that blocks execution and waits for the vehicle to</span>
</span><span id="Vehicle.await_ready_to_move-285"><a href="#Vehicle.await_ready_to_move-285"><span class="linenos">285</span></a><span class="sd">        finish the current action/movement that it was instructed to do.</span>
</span><span id="Vehicle.await_ready_to_move-286"><a href="#Vehicle.await_ready_to_move-286"><span class="linenos">286</span></a>
</span><span id="Vehicle.await_ready_to_move-287"><a href="#Vehicle.await_ready_to_move-287"><span class="linenos">287</span></a><span class="sd">        Makes use of `Vehicle.done_moving`</span>
</span><span id="Vehicle.await_ready_to_move-288"><a href="#Vehicle.await_ready_to_move-288"><span class="linenos">288</span></a>
</span><span id="Vehicle.await_ready_to_move-289"><a href="#Vehicle.await_ready_to_move-289"><span class="linenos">289</span></a><span class="sd">        Additionally, will block and request arming if the vehicle isn&#39;t yet</span>
</span><span id="Vehicle.await_ready_to_move-290"><a href="#Vehicle.await_ready_to_move-290"><span class="linenos">290</span></a><span class="sd">        armed.</span>
</span><span id="Vehicle.await_ready_to_move-291"><a href="#Vehicle.await_ready_to_move-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.await_ready_to_move-292"><a href="#Vehicle.await_ready_to_move-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
</span><span id="Vehicle.await_ready_to_move-293"><a href="#Vehicle.await_ready_to_move-293"><span class="linenos">293</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_postarm</span><span class="p">()</span> <span class="c1"># also contains logic to wait for arm</span>
</span><span id="Vehicle.await_ready_to_move-294"><a href="#Vehicle.await_ready_to_move-294"><span class="linenos">294</span></a>        
</span><span id="Vehicle.await_ready_to_move-295"><a href="#Vehicle.await_ready_to_move-295"><span class="linenos">295</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">done_moving</span><span class="p">():</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function that blocks execution and waits for the vehicle to
finish the current action/movement that it was instructed to do.</p>

<p>Makes use of <code><a href="#Vehicle.done_moving">Vehicle.done_moving</a></code></p>

<p>Additionally, will block and request arming if the vehicle isn't yet
armed.</p>
</div>


                            </div>
                            <div id="Vehicle.close" class="classattr">
                                        <input id="Vehicle.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.close-307"><a href="#Vehicle.close-307"><span class="linenos">307</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vehicle.close-308"><a href="#Vehicle.close-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.close-309"><a href="#Vehicle.close-309"><span class="linenos">309</span></a><span class="sd">        Clean up the `Vehicle` object/any state</span>
</span><span id="Vehicle.close-310"><a href="#Vehicle.close-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.close-311"><a href="#Vehicle.close-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Clean up the <code><a href="#Vehicle">Vehicle</a></code> object/any state</p>
</div>


                            </div>
                            <div id="Vehicle.set_armed" class="classattr">
                                        <input id="Vehicle.set_armed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">set_armed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.set_armed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.set_armed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.set_armed-313"><a href="#Vehicle.set_armed-313"><span class="linenos">313</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_armed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="Vehicle.set_armed-314"><a href="#Vehicle.set_armed-314"><span class="linenos">314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.set_armed-315"><a href="#Vehicle.set_armed-315"><span class="linenos">315</span></a><span class="sd">        Arm or disarm this vehicle, and wait for it to be armed (if possible)</span>
</span><span id="Vehicle.set_armed-316"><a href="#Vehicle.set_armed-316"><span class="linenos">316</span></a>
</span><span id="Vehicle.set_armed-317"><a href="#Vehicle.set_armed-317"><span class="linenos">317</span></a><span class="sd">        Dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at</span>
</span><span id="Vehicle.set_armed-318"><a href="#Vehicle.set_armed-318"><span class="linenos">318</span></a><span class="sd">        all!), so this will block execution until the vehicle has been armed.</span>
</span><span id="Vehicle.set_armed-319"><a href="#Vehicle.set_armed-319"><span class="linenos">319</span></a>
</span><span id="Vehicle.set_armed-320"><a href="#Vehicle.set_armed-320"><span class="linenos">320</span></a><span class="sd">        If the vehicle can&#39;t be armed, an Exception is raised.</span>
</span><span id="Vehicle.set_armed-321"><a href="#Vehicle.set_armed-321"><span class="linenos">321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.set_armed-322"><a href="#Vehicle.set_armed-322"><span class="linenos">322</span></a>        <span class="c1"># dronekit doesn&#39;t guarentee that the vehicle arms immediately (or at all!)</span>
</span><span id="Vehicle.set_armed-323"><a href="#Vehicle.set_armed-323"><span class="linenos">323</span></a>        <span class="c1"># this pattern keeps the funky logic out of the experimenter&#39;s script</span>
</span><span id="Vehicle.set_armed-324"><a href="#Vehicle.set_armed-324"><span class="linenos">324</span></a>        <span class="c1"># to make sure that things are safer overall</span>
</span><span id="Vehicle.set_armed-325"><a href="#Vehicle.set_armed-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">is_armable</span><span class="p">:</span>
</span><span id="Vehicle.set_armed-326"><a href="#Vehicle.set_armed-326"><span class="linenos">326</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Not ready to arm&quot;</span><span class="p">)</span> <span class="c1"># in this case, the script dies completely</span>
</span><span id="Vehicle.set_armed-327"><a href="#Vehicle.set_armed-327"><span class="linenos">327</span></a>                                                <span class="c1"># obviously not optimal *unless* we are</span>
</span><span id="Vehicle.set_armed-328"><a href="#Vehicle.set_armed-328"><span class="linenos">328</span></a>                                                <span class="c1"># certain that a scipt always arms once</span>
</span><span id="Vehicle.set_armed-329"><a href="#Vehicle.set_armed-329"><span class="linenos">329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Vehicle.set_armed-330"><a href="#Vehicle.set_armed-330"><span class="linenos">330</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">armed</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Arm or disarm this vehicle, and wait for it to be armed (if possible)</p>

<p>Dronekit doesn't guarentee that the vehicle arms immediately (or at
all!), so this will block execution until the vehicle has been armed.</p>

<p>If the vehicle can't be armed, an Exception is raised.</p>
</div>


                            </div>
                            <div id="Vehicle.goto_coordinates" class="classattr">
                                        <input id="Vehicle.goto_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">goto_coordinates</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">coordinates</span><span class="p">:</span> <span class="n"><a href="util.html#Coordinate">aerpawlib.util.Coordinate</a></span>,</span><span class="param">	<span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.goto_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.goto_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.goto_coordinates-358"><a href="#Vehicle.goto_coordinates-358"><span class="linenos">358</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vehicle.goto_coordinates-359"><a href="#Vehicle.goto_coordinates-359"><span class="linenos">359</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Vehicle.goto_coordinates-360"><a href="#Vehicle.goto_coordinates-360"><span class="linenos">360</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Vehicle.goto_coordinates-361"><a href="#Vehicle.goto_coordinates-361"><span class="linenos">361</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Vehicle.goto_coordinates-362"><a href="#Vehicle.goto_coordinates-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.goto_coordinates-363"><a href="#Vehicle.goto_coordinates-363"><span class="linenos">363</span></a><span class="sd">        Make the vehicle go to provided coordinates.</span>
</span><span id="Vehicle.goto_coordinates-364"><a href="#Vehicle.goto_coordinates-364"><span class="linenos">364</span></a>
</span><span id="Vehicle.goto_coordinates-365"><a href="#Vehicle.goto_coordinates-365"><span class="linenos">365</span></a><span class="sd">        `tolerance` is the min distance away from the coordinates, in meters,</span>
</span><span id="Vehicle.goto_coordinates-366"><a href="#Vehicle.goto_coordinates-366"><span class="linenos">366</span></a><span class="sd">        that is acceptable.</span>
</span><span id="Vehicle.goto_coordinates-367"><a href="#Vehicle.goto_coordinates-367"><span class="linenos">367</span></a>
</span><span id="Vehicle.goto_coordinates-368"><a href="#Vehicle.goto_coordinates-368"><span class="linenos">368</span></a><span class="sd">        `target_heading`, when set, will make the drone point in the specified</span>
</span><span id="Vehicle.goto_coordinates-369"><a href="#Vehicle.goto_coordinates-369"><span class="linenos">369</span></a><span class="sd">        direction (absolute). Otherwise the drone will remain pointing in the</span>
</span><span id="Vehicle.goto_coordinates-370"><a href="#Vehicle.goto_coordinates-370"><span class="linenos">370</span></a><span class="sd">        current direction. This is only available on drones.</span>
</span><span id="Vehicle.goto_coordinates-371"><a href="#Vehicle.goto_coordinates-371"><span class="linenos">371</span></a>
</span><span id="Vehicle.goto_coordinates-372"><a href="#Vehicle.goto_coordinates-372"><span class="linenos">372</span></a><span class="sd">        This method is only available for vehicles built off the `Vehicle` type</span>
</span><span id="Vehicle.goto_coordinates-373"><a href="#Vehicle.goto_coordinates-373"><span class="linenos">373</span></a><span class="sd">        (ex: `Drone` or `Rover`)</span>
</span><span id="Vehicle.goto_coordinates-374"><a href="#Vehicle.goto_coordinates-374"><span class="linenos">374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.goto_coordinates-375"><a href="#Vehicle.goto_coordinates-375"><span class="linenos">375</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Generic vehicles can&#39;t go to coordinates!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make the vehicle go to provided coordinates.</p>

<p><code>tolerance</code> is the min distance away from the coordinates, in meters,
that is acceptable.</p>

<p><code>target_heading</code>, when set, will make the drone point in the specified
direction (absolute). Otherwise the drone will remain pointing in the
current direction. This is only available on drones.</p>

<p>This method is only available for vehicles built off the <code><a href="#Vehicle">Vehicle</a></code> type
(ex: <code><a href="#Drone">Drone</a></code> or <code><a href="#Rover">Rover</a></code>)</p>
</div>


                            </div>
                            <div id="Vehicle.set_velocity" class="classattr">
                                        <input id="Vehicle.set_velocity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">set_velocity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">velocity_vector</span><span class="p">:</span> <span class="n"><a href="util.html#VectorNED">aerpawlib.util.VectorNED</a></span>,</span><span class="param">	<span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.set_velocity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.set_velocity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.set_velocity-377"><a href="#Vehicle.set_velocity-377"><span class="linenos">377</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vehicle.set_velocity-378"><a href="#Vehicle.set_velocity-378"><span class="linenos">378</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="Vehicle.set_velocity-379"><a href="#Vehicle.set_velocity-379"><span class="linenos">379</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Vehicle.set_velocity-380"><a href="#Vehicle.set_velocity-380"><span class="linenos">380</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Vehicle.set_velocity-381"><a href="#Vehicle.set_velocity-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.set_velocity-382"><a href="#Vehicle.set_velocity-382"><span class="linenos">382</span></a><span class="sd">        Set a drone&#39;s velocity that it will use for `duration` seconds.</span>
</span><span id="Vehicle.set_velocity-383"><a href="#Vehicle.set_velocity-383"><span class="linenos">383</span></a>
</span><span id="Vehicle.set_velocity-384"><a href="#Vehicle.set_velocity-384"><span class="linenos">384</span></a><span class="sd">        The velocity vector provided will be inerpreted as being global</span>
</span><span id="Vehicle.set_velocity-385"><a href="#Vehicle.set_velocity-385"><span class="linenos">385</span></a><span class="sd">        relative *in direction* unless the `global_relative` parameter is set</span>
</span><span id="Vehicle.set_velocity-386"><a href="#Vehicle.set_velocity-386"><span class="linenos">386</span></a><span class="sd">        to False.</span>
</span><span id="Vehicle.set_velocity-387"><a href="#Vehicle.set_velocity-387"><span class="linenos">387</span></a>
</span><span id="Vehicle.set_velocity-388"><a href="#Vehicle.set_velocity-388"><span class="linenos">388</span></a><span class="sd">        The vehicle will maintain this velocity for `duration` seconds, if</span>
</span><span id="Vehicle.set_velocity-389"><a href="#Vehicle.set_velocity-389"><span class="linenos">389</span></a><span class="sd">        `duration` is provided, otherwise it will automatically maintain the</span>
</span><span id="Vehicle.set_velocity-390"><a href="#Vehicle.set_velocity-390"><span class="linenos">390</span></a><span class="sd">        specified velocity until another command is sent.</span>
</span><span id="Vehicle.set_velocity-391"><a href="#Vehicle.set_velocity-391"><span class="linenos">391</span></a>
</span><span id="Vehicle.set_velocity-392"><a href="#Vehicle.set_velocity-392"><span class="linenos">392</span></a><span class="sd">        The vehicle&#39;s velocity vector, if it has a magnitude greater than the</span>
</span><span id="Vehicle.set_velocity-393"><a href="#Vehicle.set_velocity-393"><span class="linenos">393</span></a><span class="sd">        configured &quot;max_velocity&quot; (configurable in aerpawlib by using a config.yaml</span>
</span><span id="Vehicle.set_velocity-394"><a href="#Vehicle.set_velocity-394"><span class="linenos">394</span></a><span class="sd">        file with the --vehicle-config argument, defaults to 5 m/s), will be</span>
</span><span id="Vehicle.set_velocity-395"><a href="#Vehicle.set_velocity-395"><span class="linenos">395</span></a><span class="sd">        normalized and rescaled such that the new magnitude is equal to the</span>
</span><span id="Vehicle.set_velocity-396"><a href="#Vehicle.set_velocity-396"><span class="linenos">396</span></a><span class="sd">        maximum velocity.</span>
</span><span id="Vehicle.set_velocity-397"><a href="#Vehicle.set_velocity-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.set_velocity-398"><a href="#Vehicle.set_velocity-398"><span class="linenos">398</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;set_velocity not implemented&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set a drone's velocity that it will use for <code>duration</code> seconds.</p>

<p>The velocity vector provided will be inerpreted as being global
relative <em>in direction</em> unless the <code>global_relative</code> parameter is set
to False.</p>

<p>The vehicle will maintain this velocity for <code>duration</code> seconds, if
<code>duration</code> is provided, otherwise it will automatically maintain the
specified velocity until another command is sent.</p>

<p>The vehicle's velocity vector, if it has a magnitude greater than the
configured "max_velocity" (configurable in aerpawlib by using a config.yaml
file with the --vehicle-config argument, defaults to 5 m/s), will be
normalized and rescaled such that the new magnitude is equal to the
maximum velocity.</p>
</div>


                            </div>
                            <div id="Vehicle.set_groundspeed" class="classattr">
                                        <input id="Vehicle.set_groundspeed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">set_groundspeed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Vehicle.set_groundspeed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vehicle.set_groundspeed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vehicle.set_groundspeed-400"><a href="#Vehicle.set_groundspeed-400"><span class="linenos">400</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_groundspeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Vehicle.set_groundspeed-401"><a href="#Vehicle.set_groundspeed-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vehicle.set_groundspeed-402"><a href="#Vehicle.set_groundspeed-402"><span class="linenos">402</span></a><span class="sd">        Set a vehicle&#39;s cruise velocity as used by the autopilot when performing</span>
</span><span id="Vehicle.set_groundspeed-403"><a href="#Vehicle.set_groundspeed-403"><span class="linenos">403</span></a><span class="sd">        guided movement operations (ex: goto_coordinates). In m/s.</span>
</span><span id="Vehicle.set_groundspeed-404"><a href="#Vehicle.set_groundspeed-404"><span class="linenos">404</span></a>
</span><span id="Vehicle.set_groundspeed-405"><a href="#Vehicle.set_groundspeed-405"><span class="linenos">405</span></a><span class="sd">        NOTE:</span>
</span><span id="Vehicle.set_groundspeed-406"><a href="#Vehicle.set_groundspeed-406"><span class="linenos">406</span></a><span class="sd">            This is not always respected by the autopilot and will not succeed</span>
</span><span id="Vehicle.set_groundspeed-407"><a href="#Vehicle.set_groundspeed-407"><span class="linenos">407</span></a><span class="sd">            on rover type vehicles in simulation.</span>
</span><span id="Vehicle.set_groundspeed-408"><a href="#Vehicle.set_groundspeed-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vehicle.set_groundspeed-409"><a href="#Vehicle.set_groundspeed-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">groundspeed</span> <span class="o">=</span> <span class="n">velocity</span>
</span></pre></div>


            <div class="docstring"><p>Set a vehicle's cruise velocity as used by the autopilot when performing
guided movement operations (ex: goto_coordinates). In m/s.</p>

<p>NOTE:
    This is not always respected by the autopilot and will not succeed
    on rover type vehicles in simulation.</p>
</div>


                            </div>
                </section>
                <section id="Drone">
                            <input id="Drone-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Drone</span><wbr>(<span class="base"><a href="#Vehicle">Vehicle</a></span>):

                <label class="view-source-button" for="Drone-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone-422"><a href="#Drone-422"><span class="linenos">422</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Drone</span><span class="p">(</span><span class="n">Vehicle</span><span class="p">):</span>
</span><span id="Drone-423"><a href="#Drone-423"><span class="linenos">423</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone-424"><a href="#Drone-424"><span class="linenos">424</span></a><span class="sd">    Drone vehicle type. Implements all functionality that AERPAW&#39;s drones</span>
</span><span id="Drone-425"><a href="#Drone-425"><span class="linenos">425</span></a><span class="sd">    expose to user scripts, which includes basic movement control (going to</span>
</span><span id="Drone-426"><a href="#Drone-426"><span class="linenos">426</span></a><span class="sd">    coords, turning, landing).</span>
</span><span id="Drone-427"><a href="#Drone-427"><span class="linenos">427</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Drone-428"><a href="#Drone-428"><span class="linenos">428</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lock_in</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Drone-429"><a href="#Drone-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone-430"><a href="#Drone-430"><span class="linenos">430</span></a><span class="sd">        Set the heading of the vehicle (in absolute deg).</span>
</span><span id="Drone-431"><a href="#Drone-431"><span class="linenos">431</span></a><span class="sd">        </span>
</span><span id="Drone-432"><a href="#Drone-432"><span class="linenos">432</span></a><span class="sd">        To turn a relative # of degrees, you can do something like</span>
</span><span id="Drone-433"><a href="#Drone-433"><span class="linenos">433</span></a><span class="sd">        `drone.set_heading(drone.heading + x)`</span>
</span><span id="Drone-434"><a href="#Drone-434"><span class="linenos">434</span></a>
</span><span id="Drone-435"><a href="#Drone-435"><span class="linenos">435</span></a><span class="sd">        Pass in `None` to make the drone return to ardupilot&#39;s default heading</span>
</span><span id="Drone-436"><a href="#Drone-436"><span class="linenos">436</span></a><span class="sd">        behavior (usually facing the direction of movement)</span>
</span><span id="Drone-437"><a href="#Drone-437"><span class="linenos">437</span></a>
</span><span id="Drone-438"><a href="#Drone-438"><span class="linenos">438</span></a><span class="sd">        If `blocking` is `True`, this will wait for the current movement command</span>
</span><span id="Drone-439"><a href="#Drone-439"><span class="linenos">439</span></a><span class="sd">        to finish before setting the controller&#39;s yaw -- in this case, the drone</span>
</span><span id="Drone-440"><a href="#Drone-440"><span class="linenos">440</span></a><span class="sd">        will immediately start turning. If `blocking` is `False`, the new yaw </span>
</span><span id="Drone-441"><a href="#Drone-441"><span class="linenos">441</span></a><span class="sd">        will only affect future commands that interact with the yaw controller</span>
</span><span id="Drone-442"><a href="#Drone-442"><span class="linenos">442</span></a><span class="sd">        (ex: `set_velocity`)</span>
</span><span id="Drone-443"><a href="#Drone-443"><span class="linenos">443</span></a>
</span><span id="Drone-444"><a href="#Drone-444"><span class="linenos">444</span></a><span class="sd">        If `lock_in` is `True`, subsequent commands that could affect the heading</span>
</span><span id="Drone-445"><a href="#Drone-445"><span class="linenos">445</span></a><span class="sd">        will respect the heading set by this command. If it is false, consider this</span>
</span><span id="Drone-446"><a href="#Drone-446"><span class="linenos">446</span></a><span class="sd">        call to temporarily set the heading.</span>
</span><span id="Drone-447"><a href="#Drone-447"><span class="linenos">447</span></a>
</span><span id="Drone-448"><a href="#Drone-448"><span class="linenos">448</span></a><span class="sd">        An example of this in action is as follows: set_heading is called to lock in</span>
</span><span id="Drone-449"><a href="#Drone-449"><span class="linenos">449</span></a><span class="sd">        a 90 degree heading, followed by a goto command. The goto command will look</span>
</span><span id="Drone-450"><a href="#Drone-450"><span class="linenos">450</span></a><span class="sd">        at the 90 degrees heading set before. If lock_in were false, the goto</span>
</span><span id="Drone-451"><a href="#Drone-451"><span class="linenos">451</span></a><span class="sd">        command would make the drone face the direction of travel.</span>
</span><span id="Drone-452"><a href="#Drone-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone-453"><a href="#Drone-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="Drone-454"><a href="#Drone-454"><span class="linenos">454</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone-455"><a href="#Drone-455"><span class="linenos">455</span></a>
</span><span id="Drone-456"><a href="#Drone-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="n">heading</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone-457"><a href="#Drone-457"><span class="linenos">457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Drone-458"><a href="#Drone-458"><span class="linenos">458</span></a>            <span class="k">return</span>
</span><span id="Drone-459"><a href="#Drone-459"><span class="linenos">459</span></a>
</span><span id="Drone-460"><a href="#Drone-460"><span class="linenos">460</span></a>        <span class="n">heading</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="Drone-461"><a href="#Drone-461"><span class="linenos">461</span></a>        <span class="k">if</span> <span class="n">lock_in</span><span class="p">:</span>
</span><span id="Drone-462"><a href="#Drone-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="n">heading</span>
</span><span id="Drone-463"><a href="#Drone-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="Drone-464"><a href="#Drone-464"><span class="linenos">464</span></a>            <span class="k">return</span>
</span><span id="Drone-465"><a href="#Drone-465"><span class="linenos">465</span></a>        
</span><span id="Drone-466"><a href="#Drone-466"><span class="linenos">466</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">command_long_encode</span><span class="p">(</span>
</span><span id="Drone-467"><a href="#Drone-467"><span class="linenos">467</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                                       <span class="c1"># target system, component</span>
</span><span id="Drone-468"><a href="#Drone-468"><span class="linenos">468</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_CONDITION_YAW</span><span class="p">,</span>      <span class="c1"># command</span>
</span><span id="Drone-469"><a href="#Drone-469"><span class="linenos">469</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># confirmation</span>
</span><span id="Drone-470"><a href="#Drone-470"><span class="linenos">470</span></a>            <span class="n">heading</span><span class="p">,</span>                                    <span class="c1"># yaw angle in deg</span>
</span><span id="Drone-471"><a href="#Drone-471"><span class="linenos">471</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># yaw speed in deg/s</span>
</span><span id="Drone-472"><a href="#Drone-472"><span class="linenos">472</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># direction to turn in (-1: ccw, 1: cw)</span>
</span><span id="Drone-473"><a href="#Drone-473"><span class="linenos">473</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># never turn relative to our current heading</span>
</span><span id="Drone-474"><a href="#Drone-474"><span class="linenos">474</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>                                     <span class="c1"># unused</span>
</span><span id="Drone-475"><a href="#Drone-475"><span class="linenos">475</span></a>            <span class="p">)</span>
</span><span id="Drone-476"><a href="#Drone-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Drone-477"><a href="#Drone-477"><span class="linenos">477</span></a>        
</span><span id="Drone-478"><a href="#Drone-478"><span class="linenos">478</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Drone-479"><a href="#Drone-479"><span class="linenos">479</span></a>            <span class="n">_TURN_TOLERANCE_DEG</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Drone-480"><a href="#Drone-480"><span class="linenos">480</span></a>            <span class="n">turn_diff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">heading</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">-</span> <span class="p">(</span><span class="n">heading</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)]])</span>
</span><span id="Drone-481"><a href="#Drone-481"><span class="linenos">481</span></a>            <span class="k">return</span> <span class="n">turn_diff</span> <span class="o">&lt;=</span> <span class="n">_TURN_TOLERANCE_DEG</span>
</span><span id="Drone-482"><a href="#Drone-482"><span class="linenos">482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">_pointed_at_heading</span>
</span><span id="Drone-483"><a href="#Drone-483"><span class="linenos">483</span></a>
</span><span id="Drone-484"><a href="#Drone-484"><span class="linenos">484</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-485"><a href="#Drone-485"><span class="linenos">485</span></a>
</span><span id="Drone-486"><a href="#Drone-486"><span class="linenos">486</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">takeoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_alt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">min_alt_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wait_for_throttle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Drone-487"><a href="#Drone-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone-488"><a href="#Drone-488"><span class="linenos">488</span></a><span class="sd">        Make the drone take off to a specific altitude, and blocks until the</span>
</span><span id="Drone-489"><a href="#Drone-489"><span class="linenos">489</span></a><span class="sd">        drone has reached that altitude.</span>
</span><span id="Drone-490"><a href="#Drone-490"><span class="linenos">490</span></a>
</span><span id="Drone-491"><a href="#Drone-491"><span class="linenos">491</span></a><span class="sd">        Additionally waits to make sure that channel 4 of RCIN (used for yaw)</span>
</span><span id="Drone-492"><a href="#Drone-492"><span class="linenos">492</span></a><span class="sd">        is centered to avoid yaw during takeoff if the drone was *just* armed.</span>
</span><span id="Drone-493"><a href="#Drone-493"><span class="linenos">493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone-494"><a href="#Drone-494"><span class="linenos">494</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>        
</span><span id="Drone-495"><a href="#Drone-495"><span class="linenos">495</span></a>
</span><span id="Drone-496"><a href="#Drone-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">wait_for_throttle</span><span class="p">:</span>
</span><span id="Drone-497"><a href="#Drone-497"><span class="linenos">497</span></a>            <span class="c1"># TODO the below logic needs to be tested at the field (and likely made less brittle)</span>
</span><span id="Drone-498"><a href="#Drone-498"><span class="linenos">498</span></a>            <span class="c1"># wait for sticks to return to center by taking rolling avg (30 frames)</span>
</span><span id="Drone-499"><a href="#Drone-499"><span class="linenos">499</span></a>            <span class="n">rcin_4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">999</span><span class="p">]</span> <span class="o">*</span> <span class="mi">30</span> <span class="c1"># use something obviously out of range</span>
</span><span id="Drone-500"><a href="#Drone-500"><span class="linenos">500</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_rcin_4_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Drone-501"><a href="#Drone-501"><span class="linenos">501</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Drone-502"><a href="#Drone-502"><span class="linenos">502</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chan4_raw</span><span class="p">)</span>
</span><span id="Drone-503"><a href="#Drone-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="Drone-504"><a href="#Drone-504"><span class="linenos">504</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="mi">1450</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1550</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-505"><a href="#Drone-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">remove_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="Drone-506"><a href="#Drone-506"><span class="linenos">506</span></a>        
</span><span id="Drone-507"><a href="#Drone-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone-508"><a href="#Drone-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Drone-509"><a href="#Drone-509"><span class="linenos">509</span></a>
</span><span id="Drone-510"><a href="#Drone-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_takeoff</span><span class="p">(</span><span class="n">target_alt</span><span class="p">)</span>
</span><span id="Drone-511"><a href="#Drone-511"><span class="linenos">511</span></a>        
</span><span id="Drone-512"><a href="#Drone-512"><span class="linenos">512</span></a>        <span class="n">taken_off</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">alt</span> <span class="o">&gt;=</span> <span class="n">target_alt</span> <span class="o">*</span> <span class="n">min_alt_tolerance</span>
</span><span id="Drone-513"><a href="#Drone-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">taken_off</span>
</span><span id="Drone-514"><a href="#Drone-514"><span class="linenos">514</span></a>
</span><span id="Drone-515"><a href="#Drone-515"><span class="linenos">515</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">taken_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-516"><a href="#Drone-516"><span class="linenos">516</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Drone-517"><a href="#Drone-517"><span class="linenos">517</span></a>
</span><span id="Drone-518"><a href="#Drone-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">land</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Drone-519"><a href="#Drone-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone-520"><a href="#Drone-520"><span class="linenos">520</span></a><span class="sd">        Land the drone at its current position and block while waiting for it</span>
</span><span id="Drone-521"><a href="#Drone-521"><span class="linenos">521</span></a><span class="sd">        to be disarmed. No further movement is allowed after the drone has been</span>
</span><span id="Drone-522"><a href="#Drone-522"><span class="linenos">522</span></a><span class="sd">        landed (for now, may be changed later).</span>
</span><span id="Drone-523"><a href="#Drone-523"><span class="linenos">523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone-524"><a href="#Drone-524"><span class="linenos">524</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone-525"><a href="#Drone-525"><span class="linenos">525</span></a>
</span><span id="Drone-526"><a href="#Drone-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Drone-527"><a href="#Drone-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;LAND&quot;</span><span class="p">)</span>
</span><span id="Drone-528"><a href="#Drone-528"><span class="linenos">528</span></a>
</span><span id="Drone-529"><a href="#Drone-529"><span class="linenos">529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="Drone-530"><a href="#Drone-530"><span class="linenos">530</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-531"><a href="#Drone-531"><span class="linenos">531</span></a>
</span><span id="Drone-532"><a href="#Drone-532"><span class="linenos">532</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Drone-533"><a href="#Drone-533"><span class="linenos">533</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Drone-534"><a href="#Drone-534"><span class="linenos">534</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Drone-535"><a href="#Drone-535"><span class="linenos">535</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Drone-536"><a href="#Drone-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="n">target_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone-537"><a href="#Drone-537"><span class="linenos">537</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">target_heading</span><span class="p">)</span>
</span><span id="Drone-538"><a href="#Drone-538"><span class="linenos">538</span></a>        
</span><span id="Drone-539"><a href="#Drone-539"><span class="linenos">539</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone-540"><a href="#Drone-540"><span class="linenos">540</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
</span><span id="Drone-541"><a href="#Drone-541"><span class="linenos">541</span></a>
</span><span id="Drone-542"><a href="#Drone-542"><span class="linenos">542</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="Drone-543"><a href="#Drone-543"><span class="linenos">543</span></a>
</span><span id="Drone-544"><a href="#Drone-544"><span class="linenos">544</span></a>        <span class="n">heading</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
</span><span id="Drone-545"><a href="#Drone-545"><span class="linenos">545</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone-546"><a href="#Drone-546"><span class="linenos">546</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="Drone-547"><a href="#Drone-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Drone-548"><a href="#Drone-548"><span class="linenos">548</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">bearing</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="Drone-549"><a href="#Drone-549"><span class="linenos">549</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lock_in</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Drone-550"><a href="#Drone-550"><span class="linenos">550</span></a>
</span><span id="Drone-551"><a href="#Drone-551"><span class="linenos">551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">mission_item_send</span><span class="p">(</span>
</span><span id="Drone-552"><a href="#Drone-552"><span class="linenos">552</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT</span><span class="p">,</span>
</span><span id="Drone-553"><a href="#Drone-553"><span class="linenos">553</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_NAV_WAYPOINT</span><span class="p">,</span>
</span><span id="Drone-554"><a href="#Drone-554"><span class="linenos">554</span></a>            <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># unused</span>
</span><span id="Drone-555"><a href="#Drone-555"><span class="linenos">555</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># hold time</span>
</span><span id="Drone-556"><a href="#Drone-556"><span class="linenos">556</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># accept radius</span>
</span><span id="Drone-557"><a href="#Drone-557"><span class="linenos">557</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># pass radius</span>
</span><span id="Drone-558"><a href="#Drone-558"><span class="linenos">558</span></a>            <span class="n">heading</span><span class="p">,</span> <span class="c1"># yaw</span>
</span><span id="Drone-559"><a href="#Drone-559"><span class="linenos">559</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">alt</span>
</span><span id="Drone-560"><a href="#Drone-560"><span class="linenos">560</span></a>        <span class="p">)</span>
</span><span id="Drone-561"><a href="#Drone-561"><span class="linenos">561</span></a>        
</span><span id="Drone-562"><a href="#Drone-562"><span class="linenos">562</span></a>        <span class="c1"># TODO in the future we likely want to split alt into a different tolerance</span>
</span><span id="Drone-563"><a href="#Drone-563"><span class="linenos">563</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="Drone-564"><a href="#Drone-564"><span class="linenos">564</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="Drone-565"><a href="#Drone-565"><span class="linenos">565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="Drone-566"><a href="#Drone-566"><span class="linenos">566</span></a>
</span><span id="Drone-567"><a href="#Drone-567"><span class="linenos">567</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-568"><a href="#Drone-568"><span class="linenos">568</span></a>
</span><span id="Drone-569"><a href="#Drone-569"><span class="linenos">569</span></a>    <span class="n">_velocity_loop_active</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Drone-570"><a href="#Drone-570"><span class="linenos">570</span></a>
</span><span id="Drone-571"><a href="#Drone-571"><span class="linenos">571</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Drone-572"><a href="#Drone-572"><span class="linenos">572</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="Drone-573"><a href="#Drone-573"><span class="linenos">573</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Drone-574"><a href="#Drone-574"><span class="linenos">574</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Drone-575"><a href="#Drone-575"><span class="linenos">575</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone-576"><a href="#Drone-576"><span class="linenos">576</span></a>        
</span><span id="Drone-577"><a href="#Drone-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># TODO race condition bleh</span>
</span><span id="Drone-578"><a href="#Drone-578"><span class="linenos">578</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone-579"><a href="#Drone-579"><span class="linenos">579</span></a>        
</span><span id="Drone-580"><a href="#Drone-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">global_relative</span><span class="p">:</span>
</span><span id="Drone-581"><a href="#Drone-581"><span class="linenos">581</span></a>            <span class="n">velocity_vector</span> <span class="o">=</span> <span class="n">velocity_vector</span><span class="o">.</span><span class="n">rotate_by_angle</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
</span><span id="Drone-582"><a href="#Drone-582"><span class="linenos">582</span></a>
</span><span id="Drone-583"><a href="#Drone-583"><span class="linenos">583</span></a>        <span class="n">bitmask</span> <span class="o">=</span> <span class="mb">0b0000111111000111</span>     <span class="c1"># bitmask to only set speed</span>
</span><span id="Drone-584"><a href="#Drone-584"><span class="linenos">584</span></a>        <span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Drone-585"><a href="#Drone-585"><span class="linenos">585</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone-586"><a href="#Drone-586"><span class="linenos">586</span></a>            <span class="n">bitmask</span> <span class="o">&amp;=</span> <span class="n">_YAW_BITMASK</span>
</span><span id="Drone-587"><a href="#Drone-587"><span class="linenos">587</span></a>            <span class="n">yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="Drone-588"><a href="#Drone-588"><span class="linenos">588</span></a>
</span><span id="Drone-589"><a href="#Drone-589"><span class="linenos">589</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">set_position_target_global_int_encode</span><span class="p">(</span>
</span><span id="Drone-590"><a href="#Drone-590"><span class="linenos">590</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused, target sys, component</span>
</span><span id="Drone-591"><a href="#Drone-591"><span class="linenos">591</span></a>                <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT_INT</span><span class="p">,</span>
</span><span id="Drone-592"><a href="#Drone-592"><span class="linenos">592</span></a>                <span class="n">bitmask</span><span class="p">,</span>
</span><span id="Drone-593"><a href="#Drone-593"><span class="linenos">593</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused</span>
</span><span id="Drone-594"><a href="#Drone-594"><span class="linenos">594</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">north</span><span class="p">,</span>
</span><span id="Drone-595"><a href="#Drone-595"><span class="linenos">595</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">east</span><span class="p">,</span>
</span><span id="Drone-596"><a href="#Drone-596"><span class="linenos">596</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">down</span><span class="p">,</span>
</span><span id="Drone-597"><a href="#Drone-597"><span class="linenos">597</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># (unsupported) accel</span>
</span><span id="Drone-598"><a href="#Drone-598"><span class="linenos">598</span></a>                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yaw</span><span class="p">),</span> <span class="mi">0</span>    <span class="c1"># yaw/rate</span>
</span><span id="Drone-599"><a href="#Drone-599"><span class="linenos">599</span></a>                <span class="p">)</span>
</span><span id="Drone-600"><a href="#Drone-600"><span class="linenos">600</span></a>        
</span><span id="Drone-601"><a href="#Drone-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="Drone-602"><a href="#Drone-602"><span class="linenos">602</span></a>        <span class="n">target_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">duration</span> <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Drone-603"><a href="#Drone-603"><span class="linenos">603</span></a>        
</span><span id="Drone-604"><a href="#Drone-604"><span class="linenos">604</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_velocity_helper</span><span class="p">():</span>
</span><span id="Drone-605"><a href="#Drone-605"><span class="linenos">605</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span><span class="p">:</span>
</span><span id="Drone-606"><a href="#Drone-606"><span class="linenos">606</span></a>                <span class="k">if</span> <span class="n">target_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">target_end</span><span class="p">:</span>
</span><span id="Drone-607"><a href="#Drone-607"><span class="linenos">607</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Drone-608"><a href="#Drone-608"><span class="linenos">608</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Drone-609"><a href="#Drone-609"><span class="linenos">609</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>        <span class="c1"># TODO tune for better perf</span>
</span><span id="Drone-610"><a href="#Drone-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Drone-611"><a href="#Drone-611"><span class="linenos">611</span></a>        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">_velocity_helper</span><span class="p">())</span>
</span><span id="Drone-612"><a href="#Drone-612"><span class="linenos">612</span></a>
</span><span id="Drone-613"><a href="#Drone-613"><span class="linenos">613</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Drone-614"><a href="#Drone-614"><span class="linenos">614</span></a>        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
</span><span id="Drone-615"><a href="#Drone-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span>
</span><span id="Drone-616"><a href="#Drone-616"><span class="linenos">616</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Drone-617"><a href="#Drone-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Drone vehicle type. Implements all functionality that AERPAW's drones
expose to user scripts, which includes basic movement control (going to
coords, turning, landing).</p>
</div>


                            <div id="Drone.set_heading" class="classattr">
                                        <input id="Drone.set_heading-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">set_heading</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">heading</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>, </span><span class="param"><span class="n">lock_in</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Drone.set_heading-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone.set_heading"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone.set_heading-428"><a href="#Drone.set_heading-428"><span class="linenos">428</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">blocking</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lock_in</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Drone.set_heading-429"><a href="#Drone.set_heading-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone.set_heading-430"><a href="#Drone.set_heading-430"><span class="linenos">430</span></a><span class="sd">        Set the heading of the vehicle (in absolute deg).</span>
</span><span id="Drone.set_heading-431"><a href="#Drone.set_heading-431"><span class="linenos">431</span></a><span class="sd">        </span>
</span><span id="Drone.set_heading-432"><a href="#Drone.set_heading-432"><span class="linenos">432</span></a><span class="sd">        To turn a relative # of degrees, you can do something like</span>
</span><span id="Drone.set_heading-433"><a href="#Drone.set_heading-433"><span class="linenos">433</span></a><span class="sd">        `drone.set_heading(drone.heading + x)`</span>
</span><span id="Drone.set_heading-434"><a href="#Drone.set_heading-434"><span class="linenos">434</span></a>
</span><span id="Drone.set_heading-435"><a href="#Drone.set_heading-435"><span class="linenos">435</span></a><span class="sd">        Pass in `None` to make the drone return to ardupilot&#39;s default heading</span>
</span><span id="Drone.set_heading-436"><a href="#Drone.set_heading-436"><span class="linenos">436</span></a><span class="sd">        behavior (usually facing the direction of movement)</span>
</span><span id="Drone.set_heading-437"><a href="#Drone.set_heading-437"><span class="linenos">437</span></a>
</span><span id="Drone.set_heading-438"><a href="#Drone.set_heading-438"><span class="linenos">438</span></a><span class="sd">        If `blocking` is `True`, this will wait for the current movement command</span>
</span><span id="Drone.set_heading-439"><a href="#Drone.set_heading-439"><span class="linenos">439</span></a><span class="sd">        to finish before setting the controller&#39;s yaw -- in this case, the drone</span>
</span><span id="Drone.set_heading-440"><a href="#Drone.set_heading-440"><span class="linenos">440</span></a><span class="sd">        will immediately start turning. If `blocking` is `False`, the new yaw </span>
</span><span id="Drone.set_heading-441"><a href="#Drone.set_heading-441"><span class="linenos">441</span></a><span class="sd">        will only affect future commands that interact with the yaw controller</span>
</span><span id="Drone.set_heading-442"><a href="#Drone.set_heading-442"><span class="linenos">442</span></a><span class="sd">        (ex: `set_velocity`)</span>
</span><span id="Drone.set_heading-443"><a href="#Drone.set_heading-443"><span class="linenos">443</span></a>
</span><span id="Drone.set_heading-444"><a href="#Drone.set_heading-444"><span class="linenos">444</span></a><span class="sd">        If `lock_in` is `True`, subsequent commands that could affect the heading</span>
</span><span id="Drone.set_heading-445"><a href="#Drone.set_heading-445"><span class="linenos">445</span></a><span class="sd">        will respect the heading set by this command. If it is false, consider this</span>
</span><span id="Drone.set_heading-446"><a href="#Drone.set_heading-446"><span class="linenos">446</span></a><span class="sd">        call to temporarily set the heading.</span>
</span><span id="Drone.set_heading-447"><a href="#Drone.set_heading-447"><span class="linenos">447</span></a>
</span><span id="Drone.set_heading-448"><a href="#Drone.set_heading-448"><span class="linenos">448</span></a><span class="sd">        An example of this in action is as follows: set_heading is called to lock in</span>
</span><span id="Drone.set_heading-449"><a href="#Drone.set_heading-449"><span class="linenos">449</span></a><span class="sd">        a 90 degree heading, followed by a goto command. The goto command will look</span>
</span><span id="Drone.set_heading-450"><a href="#Drone.set_heading-450"><span class="linenos">450</span></a><span class="sd">        at the 90 degrees heading set before. If lock_in were false, the goto</span>
</span><span id="Drone.set_heading-451"><a href="#Drone.set_heading-451"><span class="linenos">451</span></a><span class="sd">        command would make the drone face the direction of travel.</span>
</span><span id="Drone.set_heading-452"><a href="#Drone.set_heading-452"><span class="linenos">452</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone.set_heading-453"><a href="#Drone.set_heading-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="Drone.set_heading-454"><a href="#Drone.set_heading-454"><span class="linenos">454</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone.set_heading-455"><a href="#Drone.set_heading-455"><span class="linenos">455</span></a>
</span><span id="Drone.set_heading-456"><a href="#Drone.set_heading-456"><span class="linenos">456</span></a>        <span class="k">if</span> <span class="n">heading</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone.set_heading-457"><a href="#Drone.set_heading-457"><span class="linenos">457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Drone.set_heading-458"><a href="#Drone.set_heading-458"><span class="linenos">458</span></a>            <span class="k">return</span>
</span><span id="Drone.set_heading-459"><a href="#Drone.set_heading-459"><span class="linenos">459</span></a>
</span><span id="Drone.set_heading-460"><a href="#Drone.set_heading-460"><span class="linenos">460</span></a>        <span class="n">heading</span> <span class="o">%=</span> <span class="mi">360</span>
</span><span id="Drone.set_heading-461"><a href="#Drone.set_heading-461"><span class="linenos">461</span></a>        <span class="k">if</span> <span class="n">lock_in</span><span class="p">:</span>
</span><span id="Drone.set_heading-462"><a href="#Drone.set_heading-462"><span class="linenos">462</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">=</span> <span class="n">heading</span>
</span><span id="Drone.set_heading-463"><a href="#Drone.set_heading-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">blocking</span><span class="p">:</span>
</span><span id="Drone.set_heading-464"><a href="#Drone.set_heading-464"><span class="linenos">464</span></a>            <span class="k">return</span>
</span><span id="Drone.set_heading-465"><a href="#Drone.set_heading-465"><span class="linenos">465</span></a>        
</span><span id="Drone.set_heading-466"><a href="#Drone.set_heading-466"><span class="linenos">466</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">command_long_encode</span><span class="p">(</span>
</span><span id="Drone.set_heading-467"><a href="#Drone.set_heading-467"><span class="linenos">467</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                                       <span class="c1"># target system, component</span>
</span><span id="Drone.set_heading-468"><a href="#Drone.set_heading-468"><span class="linenos">468</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_CONDITION_YAW</span><span class="p">,</span>      <span class="c1"># command</span>
</span><span id="Drone.set_heading-469"><a href="#Drone.set_heading-469"><span class="linenos">469</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># confirmation</span>
</span><span id="Drone.set_heading-470"><a href="#Drone.set_heading-470"><span class="linenos">470</span></a>            <span class="n">heading</span><span class="p">,</span>                                    <span class="c1"># yaw angle in deg</span>
</span><span id="Drone.set_heading-471"><a href="#Drone.set_heading-471"><span class="linenos">471</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># yaw speed in deg/s</span>
</span><span id="Drone.set_heading-472"><a href="#Drone.set_heading-472"><span class="linenos">472</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># direction to turn in (-1: ccw, 1: cw)</span>
</span><span id="Drone.set_heading-473"><a href="#Drone.set_heading-473"><span class="linenos">473</span></a>            <span class="mi">0</span><span class="p">,</span>                                          <span class="c1"># never turn relative to our current heading</span>
</span><span id="Drone.set_heading-474"><a href="#Drone.set_heading-474"><span class="linenos">474</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>                                     <span class="c1"># unused</span>
</span><span id="Drone.set_heading-475"><a href="#Drone.set_heading-475"><span class="linenos">475</span></a>            <span class="p">)</span>
</span><span id="Drone.set_heading-476"><a href="#Drone.set_heading-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Drone.set_heading-477"><a href="#Drone.set_heading-477"><span class="linenos">477</span></a>        
</span><span id="Drone.set_heading-478"><a href="#Drone.set_heading-478"><span class="linenos">478</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Drone.set_heading-479"><a href="#Drone.set_heading-479"><span class="linenos">479</span></a>            <span class="n">_TURN_TOLERANCE_DEG</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Drone.set_heading-480"><a href="#Drone.set_heading-480"><span class="linenos">480</span></a>            <span class="n">turn_diff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">heading</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">-</span> <span class="p">(</span><span class="n">heading</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)]])</span>
</span><span id="Drone.set_heading-481"><a href="#Drone.set_heading-481"><span class="linenos">481</span></a>            <span class="k">return</span> <span class="n">turn_diff</span> <span class="o">&lt;=</span> <span class="n">_TURN_TOLERANCE_DEG</span>
</span><span id="Drone.set_heading-482"><a href="#Drone.set_heading-482"><span class="linenos">482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">_pointed_at_heading</span>
</span><span id="Drone.set_heading-483"><a href="#Drone.set_heading-483"><span class="linenos">483</span></a>
</span><span id="Drone.set_heading-484"><a href="#Drone.set_heading-484"><span class="linenos">484</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">_pointed_at_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the heading of the vehicle (in absolute deg).</p>

<p>To turn a relative # of degrees, you can do something like
<code>drone.set_heading(drone.heading + x)</code></p>

<p>Pass in <code>None</code> to make the drone return to ardupilot's default heading
behavior (usually facing the direction of movement)</p>

<p>If <code>blocking</code> is <code>True</code>, this will wait for the current movement command
to finish before setting the controller's yaw -- in this case, the drone
will immediately start turning. If <code>blocking</code> is <code>False</code>, the new yaw 
will only affect future commands that interact with the yaw controller
(ex: <code><a href="#Drone.set_velocity">set_velocity</a></code>)</p>

<p>If <code>lock_in</code> is <code>True</code>, subsequent commands that could affect the heading
will respect the heading set by this command. If it is false, consider this
call to temporarily set the heading.</p>

<p>An example of this in action is as follows: set_heading is called to lock in
a 90 degree heading, followed by a goto command. The goto command will look
at the 90 degrees heading set before. If lock_in were false, the goto
command would make the drone face the direction of travel.</p>
</div>


                            </div>
                            <div id="Drone.takeoff" class="classattr">
                                        <input id="Drone.takeoff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">takeoff</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">target_alt</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">min_alt_tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span>,</span><span class="param">	<span class="n">wait_for_throttle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Drone.takeoff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone.takeoff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone.takeoff-486"><a href="#Drone.takeoff-486"><span class="linenos">486</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">takeoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_alt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">min_alt_tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wait_for_throttle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Drone.takeoff-487"><a href="#Drone.takeoff-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone.takeoff-488"><a href="#Drone.takeoff-488"><span class="linenos">488</span></a><span class="sd">        Make the drone take off to a specific altitude, and blocks until the</span>
</span><span id="Drone.takeoff-489"><a href="#Drone.takeoff-489"><span class="linenos">489</span></a><span class="sd">        drone has reached that altitude.</span>
</span><span id="Drone.takeoff-490"><a href="#Drone.takeoff-490"><span class="linenos">490</span></a>
</span><span id="Drone.takeoff-491"><a href="#Drone.takeoff-491"><span class="linenos">491</span></a><span class="sd">        Additionally waits to make sure that channel 4 of RCIN (used for yaw)</span>
</span><span id="Drone.takeoff-492"><a href="#Drone.takeoff-492"><span class="linenos">492</span></a><span class="sd">        is centered to avoid yaw during takeoff if the drone was *just* armed.</span>
</span><span id="Drone.takeoff-493"><a href="#Drone.takeoff-493"><span class="linenos">493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone.takeoff-494"><a href="#Drone.takeoff-494"><span class="linenos">494</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>        
</span><span id="Drone.takeoff-495"><a href="#Drone.takeoff-495"><span class="linenos">495</span></a>
</span><span id="Drone.takeoff-496"><a href="#Drone.takeoff-496"><span class="linenos">496</span></a>        <span class="k">if</span> <span class="n">wait_for_throttle</span><span class="p">:</span>
</span><span id="Drone.takeoff-497"><a href="#Drone.takeoff-497"><span class="linenos">497</span></a>            <span class="c1"># TODO the below logic needs to be tested at the field (and likely made less brittle)</span>
</span><span id="Drone.takeoff-498"><a href="#Drone.takeoff-498"><span class="linenos">498</span></a>            <span class="c1"># wait for sticks to return to center by taking rolling avg (30 frames)</span>
</span><span id="Drone.takeoff-499"><a href="#Drone.takeoff-499"><span class="linenos">499</span></a>            <span class="n">rcin_4</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">999</span><span class="p">]</span> <span class="o">*</span> <span class="mi">30</span> <span class="c1"># use something obviously out of range</span>
</span><span id="Drone.takeoff-500"><a href="#Drone.takeoff-500"><span class="linenos">500</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">_rcin_4_listener</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
</span><span id="Drone.takeoff-501"><a href="#Drone.takeoff-501"><span class="linenos">501</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Drone.takeoff-502"><a href="#Drone.takeoff-502"><span class="linenos">502</span></a>                <span class="n">rcin_4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chan4_raw</span><span class="p">)</span>
</span><span id="Drone.takeoff-503"><a href="#Drone.takeoff-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">add_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="Drone.takeoff-504"><a href="#Drone.takeoff-504"><span class="linenos">504</span></a>            <span class="k">while</span> <span class="ow">not</span> <span class="mi">1450</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">rcin_4</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1550</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone.takeoff-505"><a href="#Drone.takeoff-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">remove_message_listener</span><span class="p">(</span><span class="s2">&quot;RC_CHANNELS&quot;</span><span class="p">,</span> <span class="n">_rcin_4_listener</span><span class="p">)</span>
</span><span id="Drone.takeoff-506"><a href="#Drone.takeoff-506"><span class="linenos">506</span></a>        
</span><span id="Drone.takeoff-507"><a href="#Drone.takeoff-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone.takeoff-508"><a href="#Drone.takeoff-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Drone.takeoff-509"><a href="#Drone.takeoff-509"><span class="linenos">509</span></a>
</span><span id="Drone.takeoff-510"><a href="#Drone.takeoff-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_takeoff</span><span class="p">(</span><span class="n">target_alt</span><span class="p">)</span>
</span><span id="Drone.takeoff-511"><a href="#Drone.takeoff-511"><span class="linenos">511</span></a>        
</span><span id="Drone.takeoff-512"><a href="#Drone.takeoff-512"><span class="linenos">512</span></a>        <span class="n">taken_off</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">alt</span> <span class="o">&gt;=</span> <span class="n">target_alt</span> <span class="o">*</span> <span class="n">min_alt_tolerance</span>
</span><span id="Drone.takeoff-513"><a href="#Drone.takeoff-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">taken_off</span>
</span><span id="Drone.takeoff-514"><a href="#Drone.takeoff-514"><span class="linenos">514</span></a>
</span><span id="Drone.takeoff-515"><a href="#Drone.takeoff-515"><span class="linenos">515</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">taken_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone.takeoff-516"><a href="#Drone.takeoff-516"><span class="linenos">516</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make the drone take off to a specific altitude, and blocks until the
drone has reached that altitude.</p>

<p>Additionally waits to make sure that channel 4 of RCIN (used for yaw)
is centered to avoid yaw during takeoff if the drone was <em>just</em> armed.</p>
</div>


                            </div>
                            <div id="Drone.land" class="classattr">
                                        <input id="Drone.land-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">land</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Drone.land-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone.land"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone.land-518"><a href="#Drone.land-518"><span class="linenos">518</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">land</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Drone.land-519"><a href="#Drone.land-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Drone.land-520"><a href="#Drone.land-520"><span class="linenos">520</span></a><span class="sd">        Land the drone at its current position and block while waiting for it</span>
</span><span id="Drone.land-521"><a href="#Drone.land-521"><span class="linenos">521</span></a><span class="sd">        to be disarmed. No further movement is allowed after the drone has been</span>
</span><span id="Drone.land-522"><a href="#Drone.land-522"><span class="linenos">522</span></a><span class="sd">        landed (for now, may be changed later).</span>
</span><span id="Drone.land-523"><a href="#Drone.land-523"><span class="linenos">523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Drone.land-524"><a href="#Drone.land-524"><span class="linenos">524</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone.land-525"><a href="#Drone.land-525"><span class="linenos">525</span></a>
</span><span id="Drone.land-526"><a href="#Drone.land-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_abortable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Drone.land-527"><a href="#Drone.land-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">dronekit</span><span class="o">.</span><span class="n">VehicleMode</span><span class="p">(</span><span class="s2">&quot;LAND&quot;</span><span class="p">)</span>
</span><span id="Drone.land-528"><a href="#Drone.land-528"><span class="linenos">528</span></a>
</span><span id="Drone.land-529"><a href="#Drone.land-529"><span class="linenos">529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="Drone.land-530"><a href="#Drone.land-530"><span class="linenos">530</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">armed</span><span class="p">:</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Land the drone at its current position and block while waiting for it
to be disarmed. No further movement is allowed after the drone has been
landed (for now, may be changed later).</p>
</div>


                            </div>
                            <div id="Drone.goto_coordinates" class="classattr">
                                        <input id="Drone.goto_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">goto_coordinates</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">coordinates</span><span class="p">:</span> <span class="n"><a href="util.html#Coordinate">aerpawlib.util.Coordinate</a></span>,</span><span class="param">	<span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Drone.goto_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone.goto_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone.goto_coordinates-532"><a href="#Drone.goto_coordinates-532"><span class="linenos">532</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Drone.goto_coordinates-533"><a href="#Drone.goto_coordinates-533"><span class="linenos">533</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Drone.goto_coordinates-534"><a href="#Drone.goto_coordinates-534"><span class="linenos">534</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="Drone.goto_coordinates-535"><a href="#Drone.goto_coordinates-535"><span class="linenos">535</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Drone.goto_coordinates-536"><a href="#Drone.goto_coordinates-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="n">target_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone.goto_coordinates-537"><a href="#Drone.goto_coordinates-537"><span class="linenos">537</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">target_heading</span><span class="p">)</span>
</span><span id="Drone.goto_coordinates-538"><a href="#Drone.goto_coordinates-538"><span class="linenos">538</span></a>        
</span><span id="Drone.goto_coordinates-539"><a href="#Drone.goto_coordinates-539"><span class="linenos">539</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone.goto_coordinates-540"><a href="#Drone.goto_coordinates-540"><span class="linenos">540</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>
</span><span id="Drone.goto_coordinates-541"><a href="#Drone.goto_coordinates-541"><span class="linenos">541</span></a>
</span><span id="Drone.goto_coordinates-542"><a href="#Drone.goto_coordinates-542"><span class="linenos">542</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="Drone.goto_coordinates-543"><a href="#Drone.goto_coordinates-543"><span class="linenos">543</span></a>
</span><span id="Drone.goto_coordinates-544"><a href="#Drone.goto_coordinates-544"><span class="linenos">544</span></a>        <span class="n">heading</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
</span><span id="Drone.goto_coordinates-545"><a href="#Drone.goto_coordinates-545"><span class="linenos">545</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone.goto_coordinates-546"><a href="#Drone.goto_coordinates-546"><span class="linenos">546</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="Drone.goto_coordinates-547"><a href="#Drone.goto_coordinates-547"><span class="linenos">547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Drone.goto_coordinates-548"><a href="#Drone.goto_coordinates-548"><span class="linenos">548</span></a>            <span class="n">heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">bearing</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="Drone.goto_coordinates-549"><a href="#Drone.goto_coordinates-549"><span class="linenos">549</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_heading</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lock_in</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blocking</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Drone.goto_coordinates-550"><a href="#Drone.goto_coordinates-550"><span class="linenos">550</span></a>
</span><span id="Drone.goto_coordinates-551"><a href="#Drone.goto_coordinates-551"><span class="linenos">551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">mission_item_send</span><span class="p">(</span>
</span><span id="Drone.goto_coordinates-552"><a href="#Drone.goto_coordinates-552"><span class="linenos">552</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT</span><span class="p">,</span>
</span><span id="Drone.goto_coordinates-553"><a href="#Drone.goto_coordinates-553"><span class="linenos">553</span></a>            <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_CMD_NAV_WAYPOINT</span><span class="p">,</span>
</span><span id="Drone.goto_coordinates-554"><a href="#Drone.goto_coordinates-554"><span class="linenos">554</span></a>            <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># unused</span>
</span><span id="Drone.goto_coordinates-555"><a href="#Drone.goto_coordinates-555"><span class="linenos">555</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># hold time</span>
</span><span id="Drone.goto_coordinates-556"><a href="#Drone.goto_coordinates-556"><span class="linenos">556</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># accept radius</span>
</span><span id="Drone.goto_coordinates-557"><a href="#Drone.goto_coordinates-557"><span class="linenos">557</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="c1"># pass radius</span>
</span><span id="Drone.goto_coordinates-558"><a href="#Drone.goto_coordinates-558"><span class="linenos">558</span></a>            <span class="n">heading</span><span class="p">,</span> <span class="c1"># yaw</span>
</span><span id="Drone.goto_coordinates-559"><a href="#Drone.goto_coordinates-559"><span class="linenos">559</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">alt</span>
</span><span id="Drone.goto_coordinates-560"><a href="#Drone.goto_coordinates-560"><span class="linenos">560</span></a>        <span class="p">)</span>
</span><span id="Drone.goto_coordinates-561"><a href="#Drone.goto_coordinates-561"><span class="linenos">561</span></a>        
</span><span id="Drone.goto_coordinates-562"><a href="#Drone.goto_coordinates-562"><span class="linenos">562</span></a>        <span class="c1"># TODO in the future we likely want to split alt into a different tolerance</span>
</span><span id="Drone.goto_coordinates-563"><a href="#Drone.goto_coordinates-563"><span class="linenos">563</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="Drone.goto_coordinates-564"><a href="#Drone.goto_coordinates-564"><span class="linenos">564</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="Drone.goto_coordinates-565"><a href="#Drone.goto_coordinates-565"><span class="linenos">565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="Drone.goto_coordinates-566"><a href="#Drone.goto_coordinates-566"><span class="linenos">566</span></a>
</span><span id="Drone.goto_coordinates-567"><a href="#Drone.goto_coordinates-567"><span class="linenos">567</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make the vehicle go to provided coordinates.</p>

<p><code>tolerance</code> is the min distance away from the coordinates, in meters,
that is acceptable.</p>

<p><code>target_heading</code>, when set, will make the drone point in the specified
direction (absolute). Otherwise the drone will remain pointing in the
current direction. This is only available on drones.</p>

<p>This method is only available for vehicles built off the <code><a href="#Vehicle">Vehicle</a></code> type
(ex: <code><a href="#Drone">Drone</a></code> or <code><a href="#Rover">Rover</a></code>)</p>
</div>


                            </div>
                            <div id="Drone.set_velocity" class="classattr">
                                        <input id="Drone.set_velocity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">set_velocity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">velocity_vector</span><span class="p">:</span> <span class="n"><a href="util.html#VectorNED">aerpawlib.util.VectorNED</a></span>,</span><span class="param">	<span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">duration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Drone.set_velocity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Drone.set_velocity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Drone.set_velocity-571"><a href="#Drone.set_velocity-571"><span class="linenos">571</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Drone.set_velocity-572"><a href="#Drone.set_velocity-572"><span class="linenos">572</span></a>            <span class="n">velocity_vector</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">VectorNED</span><span class="p">,</span>
</span><span id="Drone.set_velocity-573"><a href="#Drone.set_velocity-573"><span class="linenos">573</span></a>            <span class="n">global_relative</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Drone.set_velocity-574"><a href="#Drone.set_velocity-574"><span class="linenos">574</span></a>            <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Drone.set_velocity-575"><a href="#Drone.set_velocity-575"><span class="linenos">575</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Drone.set_velocity-576"><a href="#Drone.set_velocity-576"><span class="linenos">576</span></a>        
</span><span id="Drone.set_velocity-577"><a href="#Drone.set_velocity-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># TODO race condition bleh</span>
</span><span id="Drone.set_velocity-578"><a href="#Drone.set_velocity-578"><span class="linenos">578</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span><span id="Drone.set_velocity-579"><a href="#Drone.set_velocity-579"><span class="linenos">579</span></a>        
</span><span id="Drone.set_velocity-580"><a href="#Drone.set_velocity-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">global_relative</span><span class="p">:</span>
</span><span id="Drone.set_velocity-581"><a href="#Drone.set_velocity-581"><span class="linenos">581</span></a>            <span class="n">velocity_vector</span> <span class="o">=</span> <span class="n">velocity_vector</span><span class="o">.</span><span class="n">rotate_by_angle</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
</span><span id="Drone.set_velocity-582"><a href="#Drone.set_velocity-582"><span class="linenos">582</span></a>
</span><span id="Drone.set_velocity-583"><a href="#Drone.set_velocity-583"><span class="linenos">583</span></a>        <span class="n">bitmask</span> <span class="o">=</span> <span class="mb">0b0000111111000111</span>     <span class="c1"># bitmask to only set speed</span>
</span><span id="Drone.set_velocity-584"><a href="#Drone.set_velocity-584"><span class="linenos">584</span></a>        <span class="n">yaw</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Drone.set_velocity-585"><a href="#Drone.set_velocity-585"><span class="linenos">585</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Drone.set_velocity-586"><a href="#Drone.set_velocity-586"><span class="linenos">586</span></a>            <span class="n">bitmask</span> <span class="o">&amp;=</span> <span class="n">_YAW_BITMASK</span>
</span><span id="Drone.set_velocity-587"><a href="#Drone.set_velocity-587"><span class="linenos">587</span></a>            <span class="n">yaw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_heading</span>
</span><span id="Drone.set_velocity-588"><a href="#Drone.set_velocity-588"><span class="linenos">588</span></a>
</span><span id="Drone.set_velocity-589"><a href="#Drone.set_velocity-589"><span class="linenos">589</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">message_factory</span><span class="o">.</span><span class="n">set_position_target_global_int_encode</span><span class="p">(</span>
</span><span id="Drone.set_velocity-590"><a href="#Drone.set_velocity-590"><span class="linenos">590</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused, target sys, component</span>
</span><span id="Drone.set_velocity-591"><a href="#Drone.set_velocity-591"><span class="linenos">591</span></a>                <span class="n">mavutil</span><span class="o">.</span><span class="n">mavlink</span><span class="o">.</span><span class="n">MAV_FRAME_GLOBAL_RELATIVE_ALT_INT</span><span class="p">,</span>
</span><span id="Drone.set_velocity-592"><a href="#Drone.set_velocity-592"><span class="linenos">592</span></a>                <span class="n">bitmask</span><span class="p">,</span>
</span><span id="Drone.set_velocity-593"><a href="#Drone.set_velocity-593"><span class="linenos">593</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># unused</span>
</span><span id="Drone.set_velocity-594"><a href="#Drone.set_velocity-594"><span class="linenos">594</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">north</span><span class="p">,</span>
</span><span id="Drone.set_velocity-595"><a href="#Drone.set_velocity-595"><span class="linenos">595</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">east</span><span class="p">,</span>
</span><span id="Drone.set_velocity-596"><a href="#Drone.set_velocity-596"><span class="linenos">596</span></a>                <span class="n">velocity_vector</span><span class="o">.</span><span class="n">down</span><span class="p">,</span>
</span><span id="Drone.set_velocity-597"><a href="#Drone.set_velocity-597"><span class="linenos">597</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1"># (unsupported) accel</span>
</span><span id="Drone.set_velocity-598"><a href="#Drone.set_velocity-598"><span class="linenos">598</span></a>                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yaw</span><span class="p">),</span> <span class="mi">0</span>    <span class="c1"># yaw/rate</span>
</span><span id="Drone.set_velocity-599"><a href="#Drone.set_velocity-599"><span class="linenos">599</span></a>                <span class="p">)</span>
</span><span id="Drone.set_velocity-600"><a href="#Drone.set_velocity-600"><span class="linenos">600</span></a>        
</span><span id="Drone.set_velocity-601"><a href="#Drone.set_velocity-601"><span class="linenos">601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="Drone.set_velocity-602"><a href="#Drone.set_velocity-602"><span class="linenos">602</span></a>        <span class="n">target_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">duration</span> <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Drone.set_velocity-603"><a href="#Drone.set_velocity-603"><span class="linenos">603</span></a>        
</span><span id="Drone.set_velocity-604"><a href="#Drone.set_velocity-604"><span class="linenos">604</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_velocity_helper</span><span class="p">():</span>
</span><span id="Drone.set_velocity-605"><a href="#Drone.set_velocity-605"><span class="linenos">605</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span><span class="p">:</span>
</span><span id="Drone.set_velocity-606"><a href="#Drone.set_velocity-606"><span class="linenos">606</span></a>                <span class="k">if</span> <span class="n">target_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">target_end</span><span class="p">:</span>
</span><span id="Drone.set_velocity-607"><a href="#Drone.set_velocity-607"><span class="linenos">607</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Drone.set_velocity-608"><a href="#Drone.set_velocity-608"><span class="linenos">608</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">send_mavlink</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Drone.set_velocity-609"><a href="#Drone.set_velocity-609"><span class="linenos">609</span></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>        <span class="c1"># TODO tune for better perf</span>
</span><span id="Drone.set_velocity-610"><a href="#Drone.set_velocity-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_loop_active</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Drone.set_velocity-611"><a href="#Drone.set_velocity-611"><span class="linenos">611</span></a>        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">_velocity_helper</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Set a drone's velocity that it will use for <code>duration</code> seconds.</p>

<p>The velocity vector provided will be inerpreted as being global
relative <em>in direction</em> unless the <code>global_relative</code> parameter is set
to False.</p>

<p>The vehicle will maintain this velocity for <code>duration</code> seconds, if
<code>duration</code> is provided, otherwise it will automatically maintain the
specified velocity until another command is sent.</p>

<p>The vehicle's velocity vector, if it has a magnitude greater than the
configured "max_velocity" (configurable in aerpawlib by using a config.yaml
file with the --vehicle-config argument, defaults to 5 m/s), will be
normalized and rescaled such that the new magnitude is equal to the
maximum velocity.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Vehicle">Vehicle</a></dt>
                                <dd id="Drone.__init__" class="function"><a href="#Vehicle.__init__">Vehicle</a></dd>
                <dd id="Drone.connected" class="variable"><a href="#Vehicle.connected">connected</a></dd>
                <dd id="Drone.position" class="variable"><a href="#Vehicle.position">position</a></dd>
                <dd id="Drone.battery" class="variable"><a href="#Vehicle.battery">battery</a></dd>
                <dd id="Drone.gps" class="variable"><a href="#Vehicle.gps">gps</a></dd>
                <dd id="Drone.armed" class="variable"><a href="#Vehicle.armed">armed</a></dd>
                <dd id="Drone.home_coords" class="variable"><a href="#Vehicle.home_coords">home_coords</a></dd>
                <dd id="Drone.heading" class="variable"><a href="#Vehicle.heading">heading</a></dd>
                <dd id="Drone.velocity" class="variable"><a href="#Vehicle.velocity">velocity</a></dd>
                <dd id="Drone.autopilot_info" class="variable"><a href="#Vehicle.autopilot_info">autopilot_info</a></dd>
                <dd id="Drone.attitude" class="variable"><a href="#Vehicle.attitude">attitude</a></dd>
                <dd id="Drone.debug_dump" class="function"><a href="#Vehicle.debug_dump">debug_dump</a></dd>
                <dd id="Drone.done_moving" class="function"><a href="#Vehicle.done_moving">done_moving</a></dd>
                <dd id="Drone.await_ready_to_move" class="function"><a href="#Vehicle.await_ready_to_move">await_ready_to_move</a></dd>
                <dd id="Drone.close" class="function"><a href="#Vehicle.close">close</a></dd>
                <dd id="Drone.set_armed" class="function"><a href="#Vehicle.set_armed">set_armed</a></dd>
                <dd id="Drone.set_groundspeed" class="function"><a href="#Vehicle.set_groundspeed">set_groundspeed</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Rover">
                            <input id="Rover-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Rover</span><wbr>(<span class="base"><a href="#Vehicle">Vehicle</a></span>):

                <label class="view-source-button" for="Rover-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rover"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rover-619"><a href="#Rover-619"><span class="linenos">619</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Rover</span><span class="p">(</span><span class="n">Vehicle</span><span class="p">):</span>
</span><span id="Rover-620"><a href="#Rover-620"><span class="linenos">620</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Rover-621"><a href="#Rover-621"><span class="linenos">621</span></a><span class="sd">    Rover vehicle type. Implements all functionality that AERPAW&#39;s rovers</span>
</span><span id="Rover-622"><a href="#Rover-622"><span class="linenos">622</span></a><span class="sd">    expose to user scripts, which includes basic movement control (going to</span>
</span><span id="Rover-623"><a href="#Rover-623"><span class="linenos">623</span></a><span class="sd">    coords).</span>
</span><span id="Rover-624"><a href="#Rover-624"><span class="linenos">624</span></a>
</span><span id="Rover-625"><a href="#Rover-625"><span class="linenos">625</span></a><span class="sd">    `target_heading` is ignored for rovers, as they can&#39;t strafe.</span>
</span><span id="Rover-626"><a href="#Rover-626"><span class="linenos">626</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Rover-627"><a href="#Rover-627"><span class="linenos">627</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Rover-628"><a href="#Rover-628"><span class="linenos">628</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Rover-629"><a href="#Rover-629"><span class="linenos">629</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span>
</span><span id="Rover-630"><a href="#Rover-630"><span class="linenos">630</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Rover-631"><a href="#Rover-631"><span class="linenos">631</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Rover-632"><a href="#Rover-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span> <span class="c1"># treat as mutex</span>
</span><span id="Rover-633"><a href="#Rover-633"><span class="linenos">633</span></a>        
</span><span id="Rover-634"><a href="#Rover-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rover-635"><a href="#Rover-635"><span class="linenos">635</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Rover-636"><a href="#Rover-636"><span class="linenos">636</span></a>        
</span><span id="Rover-637"><a href="#Rover-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_goto</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">location</span><span class="p">())</span>
</span><span id="Rover-638"><a href="#Rover-638"><span class="linenos">638</span></a>        
</span><span id="Rover-639"><a href="#Rover-639"><span class="linenos">639</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="Rover-640"><a href="#Rover-640"><span class="linenos">640</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">ground_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="Rover-641"><a href="#Rover-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="Rover-642"><a href="#Rover-642"><span class="linenos">642</span></a>
</span><span id="Rover-643"><a href="#Rover-643"><span class="linenos">643</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rover vehicle type. Implements all functionality that AERPAW's rovers
expose to user scripts, which includes basic movement control (going to
coords).</p>

<p><code>target_heading</code> is ignored for rovers, as they can't strafe.</p>
</div>


                            <div id="Rover.goto_coordinates" class="classattr">
                                        <input id="Rover.goto_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">goto_coordinates</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">coordinates</span><span class="p">:</span> <span class="n"><a href="util.html#Coordinate">aerpawlib.util.Coordinate</a></span>,</span><span class="param">	<span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.1</span>,</span><span class="param">	<span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Rover.goto_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Rover.goto_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Rover.goto_coordinates-627"><a href="#Rover.goto_coordinates-627"><span class="linenos">627</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">goto_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Rover.goto_coordinates-628"><a href="#Rover.goto_coordinates-628"><span class="linenos">628</span></a>            <span class="n">coordinates</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">,</span>
</span><span id="Rover.goto_coordinates-629"><a href="#Rover.goto_coordinates-629"><span class="linenos">629</span></a>            <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span>
</span><span id="Rover.goto_coordinates-630"><a href="#Rover.goto_coordinates-630"><span class="linenos">630</span></a>            <span class="n">target_heading</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Rover.goto_coordinates-631"><a href="#Rover.goto_coordinates-631"><span class="linenos">631</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">await_ready_to_move</span><span class="p">()</span>
</span><span id="Rover.goto_coordinates-632"><a href="#Rover.goto_coordinates-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="kc">False</span> <span class="c1"># treat as mutex</span>
</span><span id="Rover.goto_coordinates-633"><a href="#Rover.goto_coordinates-633"><span class="linenos">633</span></a>        
</span><span id="Rover.goto_coordinates-634"><a href="#Rover.goto_coordinates-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Rover.goto_coordinates-635"><a href="#Rover.goto_coordinates-635"><span class="linenos">635</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mission_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Rover.goto_coordinates-636"><a href="#Rover.goto_coordinates-636"><span class="linenos">636</span></a>        
</span><span id="Rover.goto_coordinates-637"><a href="#Rover.goto_coordinates-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vehicle</span><span class="o">.</span><span class="n">simple_goto</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">coordinates</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">location</span><span class="p">())</span>
</span><span id="Rover.goto_coordinates-638"><a href="#Rover.goto_coordinates-638"><span class="linenos">638</span></a>        
</span><span id="Rover.goto_coordinates-639"><a href="#Rover.goto_coordinates-639"><span class="linenos">639</span></a>        <span class="n">at_coords</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> \
</span><span id="Rover.goto_coordinates-640"><a href="#Rover.goto_coordinates-640"><span class="linenos">640</span></a>            <span class="n">coordinates</span><span class="o">.</span><span class="n">ground_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
</span><span id="Rover.goto_coordinates-641"><a href="#Rover.goto_coordinates-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ready_to_move</span> <span class="o">=</span> <span class="n">at_coords</span>
</span><span id="Rover.goto_coordinates-642"><a href="#Rover.goto_coordinates-642"><span class="linenos">642</span></a>
</span><span id="Rover.goto_coordinates-643"><a href="#Rover.goto_coordinates-643"><span class="linenos">643</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">at_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">_POLLING_DELAY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make the vehicle go to provided coordinates.</p>

<p><code>tolerance</code> is the min distance away from the coordinates, in meters,
that is acceptable.</p>

<p><code>target_heading</code>, when set, will make the drone point in the specified
direction (absolute). Otherwise the drone will remain pointing in the
current direction. This is only available on drones.</p>

<p>This method is only available for vehicles built off the <code><a href="#Vehicle">Vehicle</a></code> type
(ex: <code><a href="#Drone">Drone</a></code> or <code><a href="#Rover">Rover</a></code>)</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Vehicle">Vehicle</a></dt>
                                <dd id="Rover.__init__" class="function"><a href="#Vehicle.__init__">Vehicle</a></dd>
                <dd id="Rover.connected" class="variable"><a href="#Vehicle.connected">connected</a></dd>
                <dd id="Rover.position" class="variable"><a href="#Vehicle.position">position</a></dd>
                <dd id="Rover.battery" class="variable"><a href="#Vehicle.battery">battery</a></dd>
                <dd id="Rover.gps" class="variable"><a href="#Vehicle.gps">gps</a></dd>
                <dd id="Rover.armed" class="variable"><a href="#Vehicle.armed">armed</a></dd>
                <dd id="Rover.home_coords" class="variable"><a href="#Vehicle.home_coords">home_coords</a></dd>
                <dd id="Rover.heading" class="variable"><a href="#Vehicle.heading">heading</a></dd>
                <dd id="Rover.velocity" class="variable"><a href="#Vehicle.velocity">velocity</a></dd>
                <dd id="Rover.autopilot_info" class="variable"><a href="#Vehicle.autopilot_info">autopilot_info</a></dd>
                <dd id="Rover.attitude" class="variable"><a href="#Vehicle.attitude">attitude</a></dd>
                <dd id="Rover.debug_dump" class="function"><a href="#Vehicle.debug_dump">debug_dump</a></dd>
                <dd id="Rover.done_moving" class="function"><a href="#Vehicle.done_moving">done_moving</a></dd>
                <dd id="Rover.await_ready_to_move" class="function"><a href="#Vehicle.await_ready_to_move">await_ready_to_move</a></dd>
                <dd id="Rover.close" class="function"><a href="#Vehicle.close">close</a></dd>
                <dd id="Rover.set_armed" class="function"><a href="#Vehicle.set_armed">set_armed</a></dd>
                <dd id="Rover.set_velocity" class="function"><a href="#Vehicle.set_velocity">set_velocity</a></dd>
                <dd id="Rover.set_groundspeed" class="function"><a href="#Vehicle.set_groundspeed">set_groundspeed</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>